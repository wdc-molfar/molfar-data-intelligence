{"version":3,"sources":["webpack:///./src/components/widgets/ds-share/dataset-management.vue?db9e","webpack:///./src/components/widgets/ds-share/ds-io.mixin.js","webpack:///src/components/widgets/ds-share/dataset-management.vue","webpack:///./src/components/widgets/ds-share/dataset-management.vue?ea0e","webpack:///./src/components/widgets/ds-share/dataset-management.vue"],"names":["render","_vm","this","_c","_self","attrs","staticClass","_v","_s","message","on","$event","uploadCollections","collections","_e","length","staticStyle","_l","c","cIndex","key","select","class","selected","exportCollection","sampleTable","headers","rows","Number","POSITIVE_INFINITY","scopedSlots","_u","fn","props","item","rowIndex","col","index","value","staticRenderFns","methods","$dps","run","script","then","res","getBaseURL","data","url","concept","Promise","resolve","reject","type","file","state","_","isString","name","mixins","dpsDownloadCollection","window","location","href","dpsLoadSchema","catch","selectFile","resolveFile","selectFileDialog","sample","dpsUploadCollections","messages","map","m","JSON","parse","stringify","join","$djvue","warning","title","text","loadCollections","e","toString","computed","dataset","dimensions","align","source","watch","newValue","dpsLoadCollectionSample","component","VBtn","VContainer","VDataTable","VDivider","VFlex","VIcon","VLayout","VProgressCircular","VRow","VSpacer"],"mappings":"uHAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAAEF,EAAW,QAAEE,EAAG,cAAc,CAACA,EAAG,SAAS,CAACE,MAAM,CAAC,KAAO,KAAK,CAACF,EAAG,KAAK,CAACG,YAAY,4CAA4C,CAACL,EAAIM,GAAGN,EAAIO,GAAGP,EAAIQ,cAAcN,EAAG,YAAYA,EAAG,QAAQ,CAACE,MAAM,CAAC,KAAO,GAAG,MAAQ,WAAWK,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOV,EAAIW,uBAAuB,CAACX,EAAIM,GAAG,4BAA4B,GAAGJ,EAAG,cAAc,CAACE,MAAM,CAAC,OAAO,KAAK,CAAGJ,EAAIY,YAA2HZ,EAAIa,KAAlHX,EAAG,QAAQ,CAACG,YAAY,QAAQ,CAACH,EAAG,sBAAsB,CAACE,MAAM,CAAC,cAAgB,GAAG,MAAQ,cAAc,GAAaJ,EAAe,YAAEE,EAAG,WAAW,CAACE,MAAM,CAAC,OAAS,KAAK,CAAEJ,EAAe,YAAEE,EAAG,MAAM,CAACA,EAAG,QAAQ,CAACG,YAAY,OAAOD,MAAM,CAAC,eAAe,KAAK,CAACF,EAAG,KAAK,CAACG,YAAY,8CAA8C,CAACL,EAAIM,GAAG,qCAAuCN,EAAIO,GAAGP,EAAIY,YAAYE,QAAQ,0BAA0BZ,EAAG,YAAYA,EAAG,QAAQ,CAACE,MAAM,CAAC,KAAO,GAAG,MAAQ,WAAWK,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOV,EAAIW,uBAAuB,CAACX,EAAIM,GAAG,4BAA4B,GAAGJ,EAAG,SAAS,CAACa,YAAY,CAAC,aAAa,OAAO,SAAW,OAAO,OAAS,qBAAqBX,MAAM,CAAC,KAAO,GAAG,OAAO,KAAKJ,EAAIgB,GAAIhB,EAAe,aAAE,SAASiB,EAAEC,GAAQ,OAAOhB,EAAG,QAAQ,CAACiB,IAAID,EAAOb,YAAY,YAAYU,YAAY,CAAC,OAAS,WAAWN,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOV,EAAIoB,OAAOH,MAAM,CAACf,EAAG,SAAS,CAACG,YAAY,cAAcgB,MAAOrB,EAAIsB,UAAYL,GAAKjB,EAAIsB,SAAY,gBAAkB,qCAAqC,CAACtB,EAAIM,GAAG,kDAAkDJ,EAAG,KAAK,CAACG,YAAY,SAASgB,MAAOrB,EAAIsB,UAAYL,GAAKjB,EAAIsB,SAAY,gBAAkB,qCAAqC,CAACtB,EAAIM,GAAG,mBAAmBN,EAAIO,GAAGU,GAAG,qBAAqB,MAAK,IAAI,GAAGjB,EAAIa,KAAMb,EAAe,YAAEE,EAAG,MAAM,CAACA,EAAG,SAAS,CAACE,MAAM,CAAC,KAAO,GAAG,OAAO,KAAK,CAACF,EAAG,WAAW,CAACE,MAAM,CAAC,IAAM,GAAG,eAAe,KAAK,CAACF,EAAG,KAAK,CAACG,YAAY,8CAA8C,CAACL,EAAIM,GAAG,gCAAiCN,EAAIO,GAAGP,EAAIsB,UAAU,qBAAsBpB,EAAG,YAAYA,EAAG,QAAQ,CAACE,MAAM,CAAC,KAAO,GAAG,MAAQ,WAAWK,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOV,EAAIuB,iBAAiBvB,EAAIsB,aAAa,CAACtB,EAAIM,GAAG,eAAe,GAAGJ,EAAG,eAAe,CAACa,YAAY,CAAC,QAAU,eAAeX,MAAM,CAAC,QAAUJ,EAAIwB,YAAYC,QAAQ,MAAQzB,EAAIwB,YAAYE,KAAK,MAAQ,GAAG,mBAAmB,GAAG,iBAAiBC,OAAOC,kBAAkB,sBAAsB,GAAG,OAAS,QAAQ,eAAe,IAAIC,YAAY7B,EAAI8B,GAAG,CAAC,CAACX,IAAI,SAASY,GAAG,SAASC,GAAO,MAAO,CAAC9B,EAAG,KAAK,CAACE,MAAM,CAAC,QAAUJ,EAAIwB,YAAYC,QAAQX,SAAS,CAACZ,EAAG,cAAc,MAAM,CAACiB,IAAI,OAAOY,GAAG,SAASC,GAAO,MAAO,CAAC9B,EAAG,QAAQF,EAAIgB,GAAIgB,EAAW,OAAE,SAASC,EAAKC,GAAU,OAAOhC,EAAG,KAAK,CAACiB,IAAIe,GAAUlC,EAAIgB,GAAIhB,EAAIwB,YAAmB,SAAE,SAASW,EAAIC,GAAO,OAAOlC,EAAG,KAAK,CAACiB,IAAIiB,EAAM/B,YAAY,WAAW,CAACL,EAAIM,GAAG,yBAAyBN,EAAIO,GAAG0B,EAAKE,EAAIE,QAAQ,6BAA4B,MAAK,OAAO,MAAK,EAAM,eAAe,IAAI,GAAGrC,EAAIa,OAAOb,EAAIa,MAAM,IAAI,IAEj7FyB,EAAkB,G,YCFP,GACbC,QAAS,CAEP,sBAAsBtB,GACpB,OAAOhB,KAAKuC,KAAKC,IAAI,CACjBC,OAAQ,qOASMzB,0oBAsBTA,uBAIN0B,KAAKC,GAAO3C,KAAKuC,KAAKK,aAAeD,EAAIE,KAAKC,MAGnD,wBAAwBC,GACtB,OAAO/C,KAAKuC,KAAKC,IAAI,CACjBC,OAAQ,qOASMM,y7BAkCfL,KAAKC,GAAOA,EAAIE,OAGrB,gBACE,OAAO,IAAIG,QAAQ,CAACC,EAASC,KAC3BlD,KAAKuC,KAAKC,IAAI,CACVC,OAAQ,gKAQTC,KAAKC,IAEY,SAAZA,EAAIQ,KACND,EAAOP,EAAIE,MAEXI,EAAQN,EAAIE,WAMtB,qBAAqBO,GACnB,OAAOpD,KAAKuC,KAAKC,IAAI,CACnBC,OAAQ,wpIAuHRY,MAAO,GACPD,KAAMA,IACLV,KAAKC,GAAOA,EAAIE,SC1KzB,IAAIS,EAAI,CAAEC,SAAA,eAGK,OAEbC,KAAM,qBAENzB,MAAO,CAAC,UAER0B,OAAQ,CAAC,GAETnB,QAAS,CAEP,iBAAiBtB,GACfhB,KAAK0D,sBAAsB1C,GACxB0B,KAAKI,IACJa,OAAOC,SAASC,KAAOf,KAI7B,kBACE9C,KAAKW,YAAc,KACnBX,KAAK8D,gBACFpB,KAAKC,IACJ3C,KAAKW,YAAcgC,EACnB3C,KAAKO,QAAU,OAEhBwD,MAAM,KACL/D,KAAKO,QAAU,gCAIrB,OAAOyB,GACAhC,KAAKqB,SAGRrB,KAAKqB,SAAYrB,KAAKqB,UAAYW,EAAQ,KAAOA,EAFjDhC,KAAKqB,SAAWW,GAOpB,oBACEhC,KAAKgE,aACFtB,KAAKU,IACCA,GACLpD,KAAKiE,YAAYb,MAIvB,YAAYA,GACVpD,KAAKkE,kBAAmB,EACxBlE,KAAKmE,OAAS,KACdnE,KAAKW,YAAc,KACnBX,KAAKO,QAAU,eACfP,KAAKoE,qBAAqBhB,GACvBV,KAAKC,IACJ,IAAI0B,EAAW1B,EAAIE,KAAKyB,IAAIC,IAC1B,IAAI5B,EAAM6B,KAAKC,MAAMF,EAAEhE,QAAQ,IAE/B,OADAoC,EAAOW,EAAEC,SAASZ,GAAQA,EAAM6B,KAAKE,UAAU/B,EAAIE,MAC5CF,IACNgC,KAAK,MAER3E,KAAK4E,OAAOC,QAAQ,CAClB1B,KAAM,UACN2B,MAAO,qBACPC,KAAMV,IAERrE,KAAKO,QAAU,aACfP,KAAKgF,oBAENjB,MAAMkB,IACLjF,KAAK4E,OAAOC,QAAQ,CAClB1B,KAAM,QACN2B,MAAO,4BACPC,KAAME,EAAEC,iBAOlBC,SAAU,CAER,cACE,OAAKnF,KAAKmE,OACH,CACL3C,QAASxB,KAAKmE,OAAOiB,QAAQC,WAAWf,IAAItC,IAAQ,CAClD+C,KAAM/C,EACNsD,MAAO,SACPlD,MAAOJ,KAETP,KAAMzB,KAAKmE,OAAOiB,QAAQG,QAPH,OAa7BC,MAAO,CAEL,SAASC,GACFA,EAGHzF,KAAK0F,wBAAwBD,GAC1B/C,KAAKC,IACJ3C,KAAKmE,OAASxB,IAJlB3C,KAAKmE,OAAS,OAUpBtB,KAAM,KAAM,CACVlC,YAAa,KACbU,SAAU,KACV8C,OAAQ,KACRf,KAAM,KACNc,kBAAkB,EAClB3D,QAAS,eAGX,UACEP,KAAKgF,oBC3Lka,I,yJCOvaW,EAAY,eACd,EACA7F,EACAuC,GACA,EACA,KACA,KACA,MAIa,aAAAsD,EAAiB,QAchC,IAAkBA,EAAW,CAACC,OAAA,KAAKC,aAAA,KAAWC,aAAA,KAAWC,WAAA,KAASC,QAAA,KAAMC,QAAA,KAAMC,UAAA,KAAQC,oBAAA,KAAkBC,OAAA,KAAKC,UAAA","file":"js/chunk-2d21447c.407b8d17.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[(_vm.message)?_c('v-container',[_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h2',{staticClass:\"warning--text font-weight-light headline\"},[_vm._v(_vm._s(_vm.message))])]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.uploadCollections()}}},[_vm._v(\"Upload collections...\")])],1):_c('v-container',{attrs:{\"pa-0\":\"\"}},[(!_vm.collections)?_c('v-row',{staticClass:\"mx-0\"},[_c('v-progress-circular',{attrs:{\"indeterminate\":\"\",\"color\":\"primary\"}})],1):_vm._e(),(_vm.collections)?_c('v-layout',{attrs:{\"column\":\"\"}},[(_vm.collections)?_c('div',[_c('v-row',{staticClass:\"mx-0\",attrs:{\"align-center\":\"\"}},[_c('h3',{staticClass:\"primary--text font-weight-light subheading\"},[_vm._v(\"\\n            Schema: \\\"dj-data\\\" ( \"+_vm._s(_vm.collections.length)+\" items )\\n          \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.uploadCollections()}}},[_vm._v(\"Upload collections...\")])],1),_c('v-flex',{staticStyle:{\"max-height\":\"10em\",\"overflow\":\"auto\",\"border\":\"1px solid #dedede\"},attrs:{\"xs12\":\"\",\"pa-2\":\"\"}},_vm._l((_vm.collections),function(c,cIndex){return _c('v-row',{key:cIndex,staticClass:\"pt-2 mx-0\",staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){return _vm.select(c)}}},[_c('v-icon',{staticClass:\"body-1 pr-2\",class:(_vm.selected && c == _vm.selected) ? 'primary--text' : 'secondary--text font-weight-light'},[_vm._v(\"\\n              mdi-grid-large\\n            \")]),_c('h3',{staticClass:\"body-1\",class:(_vm.selected && c == _vm.selected) ? 'primary--text' : 'secondary--text font-weight-light'},[_vm._v(\"\\n              \"+_vm._s(c)+\"\\n            \")])],1)}),1)],1):_vm._e(),(_vm.sampleTable)?_c('div',[_c('v-flex',{attrs:{\"xs12\":\"\",\"pa-2\":\"\"}},[_c('v-layout',{attrs:{\"row\":\"\",\"align-center\":\"\"}},[_c('h3',{staticClass:\"primary--text subheading font-weight-light\"},[_vm._v(\"\\n              Sample from \\\"\"+_vm._s(_vm.selected)+\"\\\"\\n            \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.exportCollection(_vm.selected)}}},[_vm._v(\"Download\")])],1),_c('v-data-table',{staticStyle:{\"display\":\"inline-grid\"},attrs:{\"headers\":_vm.sampleTable.headers,\"items\":_vm.sampleTable.rows,\"dense\":\"\",\"calculate-widths\":\"\",\"items-per-page\":Number.POSITIVE_INFINITY,\"hide-default-footer\":\"\",\"height\":\"300px\",\"fixed-header\":\"\"},scopedSlots:_vm._u([{key:\"header\",fn:function(props){return [_c('td',{attrs:{\"colspan\":_vm.sampleTable.headers.length}},[_c('v-divider')],1)]}},{key:\"body\",fn:function(props){return [_c('tbody',_vm._l((props.items),function(item,rowIndex){return _c('tr',{key:rowIndex},_vm._l((_vm.sampleTable.headers),function(col,index){return _c('td',{key:index,staticClass:\"caption\"},[_vm._v(\"\\n                    \"+_vm._s(item[col.value])+\"\\n                  \")])}),0)}),0)]}}],null,false,3181246690)})],1)],1):_vm._e()]):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default {\r\n  methods: {\r\n\r\n    dpsDownloadCollection(c) {\r\n      return this.$dps.run({\r\n          script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => {\r\n\t\t\t\t\t        let res = d.value;\r\n\t\t\t\t\t        res.id = d.id\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tdml.select(from:\"${c}\", map:{{mapper}})\r\n\t\t\t\t\tset(\"data\")\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.attr = $scope.data.map( d => Object.keys(d));\r\n\t\t\t\t\t    $scope.field = [];\r\n\t\t\t\t\t    $scope.attr.forEach( a => {\r\n\t\t\t\t\t        $scope.field = _.union($scope.field,a)\r\n\t\t\t\t\t    });\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.publisher = d => {\r\n\t\t\t\t\t        let res ={}\r\n\t\t\t\t\t        $scope.field.forEach( f => {\r\n\t\t\t\t\t            res[f] = ( d[f] ) ? d[f] : null\r\n\t\t\t\t\t        })\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    }    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tget(\"data\")\r\n\t\t\t\t\tc.map({{publisher}})\r\n\r\n\r\n\t\t\t\t\texport(\"${c}.xlsx\")\r\n\r\n\t\t\t`\r\n        })\r\n        .then(res => this.$dps.getBaseURL() + res.data.url)\r\n    },\r\n\r\n    dpsLoadCollectionSample(concept) {\r\n      return this.$dps.run({\r\n          script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => {\r\n\t\t\t\t\t        let res = d.value;\r\n\t\t\t\t\t        res.id = d.id\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tdml.select(from:\"${concept}\", map:{{mapper}})\r\n\r\n\t\t\t\t\tset(\"data\")\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.attr = $scope.data.map( d => Object.keys(d));\r\n\t\t\t\t\t    $scope.field = [];\r\n\t\t\t\t\t    $scope.attr.forEach( a => {\r\n\t\t\t\t\t        $scope.field = _.union($scope.field,a)\r\n\t\t\t\t\t    });\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.publisher = d => {\r\n\t\t\t\t\t        let res ={}\r\n\t\t\t\t\t        $scope.field.forEach( f => {\r\n\t\t\t\t\t            res[f] = ( d[f] ) ? d[f] : null\r\n\t\t\t\t\t        })\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tget(\"data\")\r\n\t\t\t\t\tc.limit()\r\n\t\t\t\t\tc.map({{publisher}})\r\n\t\t\t\t\tset(\"data\")\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.res = {\r\n\t\t\t\t\t        dataset:{\r\n\t\t\t\t\t            dimensions: Object.keys($scope.data[0]),\r\n\t\t\t\t\t            source: $scope.data\r\n\t\t\t\t\t        }\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\t\t\t\t\treturn(\"res\")\r\n\t\t\t\t`\r\n        })\r\n        .then(res => res.data)\r\n    },\r\n\r\n    dpsLoadSchema() {\r\n      return new Promise((resolve, reject) => {\r\n        this.$dps.run({\r\n            script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => d.identity\r\n\t\t\t\t\t?>\r\n\t\t\t\t\tddl.desc(\"dj-data\")\r\n\t\t\t\t\tc.map({{mapper}})\r\n\t\t\t\t`\r\n          })\r\n          .then(res => {\r\n            // console.log(res)\r\n            if (res.type == \"error\") {\r\n              reject(res.data)\r\n            } else {\r\n              resolve(res.data)\r\n            }\r\n          })\r\n      })\r\n    },\r\n\r\n    dpsUploadCollections(file) {\r\n      return this.$dps.run({\r\n        script: `\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.file = $scope.$file.name;\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tfile.load({{file}})\r\n\t\t\t\t\tset(\"db\")\r\n\t\t\t\t\tddl.desc()\r\n\t\t\t\t\tset(\"collections\")\r\n\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    let m = {\r\n\t\t\t\t\t        \"identity\": \"\",\r\n\t\t\t\t\t        \"schema\": \"dj-data\",\r\n\t\t\t\t\t        \"attributes\": {\r\n\t\t\t\t\t            \"value\": {\r\n\t\t\t\t\t                \"type\": \"json\"\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        },\r\n\t\t\t\t\t        \"permissions\": {\r\n\t\t\t\t\t            \"create\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"alter\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"drop\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"desc\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"select\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"any\",\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"insert\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"update\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"delete\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        },\r\n\t\t\t\t\t    };    \r\n\t\t\t\t\t    \r\n\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.sheets = Object.keys($scope.db);\r\n\t\t\t\t\t    $scope.collections = $scope.collections.map(c => c.identity)\r\n\r\n\t\t\t\t\t    $scope.toBeDrop = $scope.sheets\r\n\t\t\t\t\t                        .filter( s => _.find($scope.collections, c => c == s))\r\n\r\n\t\t\t\t\t    $scope.toBeCreate = $scope.sheets\r\n\t\t\t\t\t                .map( s => {\r\n\t\t\t\t\t\t                 let res = Object.assign({},m);\r\n\t\t\t\t\t\t                 res.identity = s\r\n\t\t\t\t\t\t                 return res\r\n\t\t\t\t\t                });\r\n\t\t\t\t\t    $scope.values = $scope.sheets.map( s => $scope.db[s].map(v=> ({id:v.id, value:v})));\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.ddlDropScript = $scope.toBeDrop\r\n\t\t\t\t\t        .map( c => \r\n\t\t\t\t\t            'ddl.drop(model:\"'+c+'\");info(\"'+c+'\")'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\")\r\n\t\t\t\t\t    $scope.ddlDropScript = ($scope.ddlDropScript) ? $scope.ddlDropScript : \"ctx('noop')\"\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.ddlCreateScript = $scope.toBeCreate\r\n\t\t\t\t\t        .map( ( c, index ) => \r\n\t\t\t\t\t            'info({{toBeCreate['+index+'].identity}});ddl.create(model:{{toBeCreate['+index+']}})'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\");\r\n\t\t\t\t\t    $scope.ddlCreateScript = ($scope.ddlCreateScript) ? $scope.ddlCreateScript : \"ctx('noop')\"\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.dmlScript = $scope.sheets\r\n\t\t\t\t\t        .map( ( s, index ) => \r\n\t\t\t\t\t            'info(\"'+s+'\");dml.insertOrUpdate(into:\"'+s+'\", values:{{values['+index+']}});info()'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\");\r\n\t\t\t\t\t    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tinfo(\"Drop collections\")\r\n\t\t\t\t\trun({{ddlDropScript}})\r\n\t\t\t\t\tinfo(\"Create collections\")\r\n\t\t\t\t\trun({{ddlCreateScript}})\r\n\t\t\t\t\tinfo(\"Insert or update values\")\r\n\t\t\t\t\trun({{dmlScript}})\r\n\t\t\t\t\tlog()\r\n\t\t\t\t\t`,\r\n        state: {},\r\n        file: file\r\n      }).then(res => res.data)\r\n    }\r\n  }\r\n}\r\n","<template>\r\n  <div>\r\n    <v-container v-if=\"message\">\r\n      <v-flex xs12>\r\n        <h2 class=\"warning--text font-weight-light headline\">{{message}}</h2>\r\n      </v-flex>\r\n      <v-spacer></v-spacer>\r\n      <v-btn text color=\"primary\" @click=\"uploadCollections()\">Upload collections...</v-btn>\r\n    </v-container>\r\n    <v-container v-else pa-0>\r\n      <v-row class=\"mx-0\" v-if=\"!collections\">\r\n        <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\r\n      </v-row>\r\n      <v-layout column v-if=\"collections\">\r\n        <div v-if=\"collections\">\r\n          <v-row class=\"mx-0\" align-center>\r\n            <h3 class=\"primary--text font-weight-light subheading\">\r\n              Schema: \"dj-data\" ( {{collections.length}} items )\r\n            </h3>\r\n            <v-spacer></v-spacer>\r\n            <v-btn text color=\"primary\" @click=\"uploadCollections()\">Upload collections...</v-btn>\r\n          </v-row>\r\n          <v-flex xs12 pa-2 style=\"max-height:10em; overflow:auto; border:1px solid #dedede;\">\r\n            <v-row v-for=\"(c, cIndex) in collections\" :key=\"cIndex\" class=\"pt-2 mx-0\" style=\"cursor:pointer;\" @click=\"select(c)\">\r\n              <v-icon class=\"body-1 pr-2\" :class=\"(selected && c == selected) ? 'primary--text' : 'secondary--text font-weight-light'\">\r\n                mdi-grid-large\r\n              </v-icon>\r\n              <h3 class=\"body-1\" :class=\"(selected && c == selected) ? 'primary--text' : 'secondary--text font-weight-light'\">\r\n                {{c}}\r\n              </h3>\r\n            </v-row>\r\n          </v-flex>\r\n        </div>\r\n        <div v-if=\"sampleTable\">\r\n          <v-flex xs12 pa-2>\r\n            <v-layout row align-center>\r\n              <h3 class=\"primary--text subheading font-weight-light\">\r\n                Sample from \"{{selected}}\"\r\n              </h3>\r\n              <v-spacer></v-spacer>\r\n              <v-btn text color=\"primary\" @click=\"exportCollection(selected)\">Download</v-btn>\r\n            </v-layout>\r\n            <v-data-table :headers=\"sampleTable.headers\" :items=\"sampleTable.rows\" dense calculate-widths :items-per-page=\"Number.POSITIVE_INFINITY\" hide-default-footer style=\"display: inline-grid;\" height=\"300px\" fixed-header>\r\n              <template v-slot:header=\"props\">\r\n                <td :colspan=\"sampleTable.headers.length\">\r\n                  <v-divider></v-divider>\r\n                </td>\r\n              </template>\r\n              <template v-slot:body=\"props\">\r\n                <tbody>\r\n                  <tr v-for=\"(item, rowIndex) in props.items\" :key=\"rowIndex\">\r\n                    <td v-for=\"(col, index) in sampleTable.headers\" :key=\"index\" class=\"caption\">\r\n                      {{item[col.value]}}\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </template>\r\n            </v-data-table>\r\n          </v-flex>\r\n        </div>\r\n      </v-layout>\r\n    </v-container>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { isString } from \"lodash\"\r\nlet _ = { isString }\r\nimport ioMixin from \"./ds-io.mixin.js\"\r\n\r\nexport default {\r\n\r\n  name: \"dataset-management\",\r\n\r\n  props: [\"config\"],\r\n\r\n  mixins: [ioMixin],\r\n\r\n  methods: {\r\n\r\n    exportCollection(c) {\r\n      this.dpsDownloadCollection(c)\r\n        .then(url => {\r\n          window.location.href = url\r\n        })\r\n    },\r\n\r\n    loadCollections() {\r\n      this.collections = null;\r\n      this.dpsLoadSchema()\r\n        .then(res => {\r\n          this.collections = res;\r\n          this.message = null\r\n        })\r\n        .catch(() => {\r\n          this.message = `Schema \"dj-data\" is empty.`\r\n        })\r\n    },\r\n\r\n    select(item) {\r\n      if (!this.selected) {\r\n        this.selected = item\r\n      } else {\r\n        this.selected = (this.selected == item) ? null : item\r\n      }\r\n    },\r\n\r\n\r\n    uploadCollections() {\r\n      this.selectFile()\r\n        .then(file => {\r\n          if (!file) return\r\n          this.resolveFile(file)\r\n        })\r\n    },\r\n\r\n    resolveFile(file) {\r\n      this.selectFileDialog = false;\r\n      this.sample = null;\r\n      this.collections = null;\r\n      this.message = \"Uploading...\"\r\n      this.dpsUploadCollections(file)\r\n        .then(res => {\r\n          let messages = res.data.map(m => {\r\n            let res = JSON.parse(m.message[0])\r\n            res = (_.isString(res)) ? res : JSON.stringify(res.data)\r\n            return res\r\n          }).join(\"\\n\")\r\n\r\n          this.$djvue.warning({\r\n            type: \"success\",\r\n            title: \"Upload Collections\",\r\n            text: messages\r\n          })\r\n          this.message = \"Loading...\"\r\n          this.loadCollections()\r\n        })\r\n        .catch(e => {\r\n          this.$djvue.warning({\r\n            type: \"error\",\r\n            title: \"Cannot Upload Collections\",\r\n            text: e.toString()\r\n          })\r\n        })\r\n    }\r\n\r\n  },\r\n\r\n  computed: {\r\n\r\n    sampleTable() {\r\n      if (!this.sample) return null\r\n      return {\r\n        headers: this.sample.dataset.dimensions.map(item => ({\r\n          text: item,\r\n          align: 'center',\r\n          value: item\r\n        })),\r\n        rows: this.sample.dataset.source\r\n      }\r\n    }\r\n\r\n  },\r\n\r\n  watch: {\r\n\r\n    selected(newValue) {\r\n      if (!newValue) {\r\n        this.sample = null\r\n      } else {\r\n        this.dpsLoadCollectionSample(newValue)\r\n          .then(res => {\r\n            this.sample = res\r\n          })\r\n      }\r\n    }\r\n  },\r\n\r\n  data: () => ({\r\n    collections: null,\r\n    selected: null,\r\n    sample: null,\r\n    file: null,\r\n    selectFileDialog: false,\r\n    message: \"Loading...\"\r\n  }),\r\n\r\n  created() {\r\n    this.loadCollections()\r\n  }\r\n}\r\n\r\n</script>\r\n","import mod from \"-!../../../../build/vuetify-loader/lib/loader.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../build/jace-loader/src/parser.js??ref--20-3!../../../../build/jace-loader/src/parser.js??ref--18-1!../../../../build/jace-loader/src/parser.js??ref--33-1!./dataset-management.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../build/vuetify-loader/lib/loader.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../build/jace-loader/src/parser.js??ref--20-3!../../../../build/jace-loader/src/parser.js??ref--18-1!../../../../build/jace-loader/src/parser.js??ref--33-1!./dataset-management.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./dataset-management.vue?vue&type=template&id=c4b39e76&\"\nimport script from \"./dataset-management.vue?vue&type=script&lang=js&\"\nexport * from \"./dataset-management.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../build/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VFlex } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VContainer,VDataTable,VDivider,VFlex,VIcon,VLayout,VProgressCircular,VRow,VSpacer})\n"],"sourceRoot":""}