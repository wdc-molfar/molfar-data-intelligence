(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e803df42","chunk-f9d6da72"],{2751:function(t,e,i){},"3e31":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{class:t.editorClass,style:t.editorStyle})},a=[],n=i("c555"),o=i("4e14");let c;var l={name:"editor",mixins:[n["a"],o["a"]],props:{content:{type:String,default:"\n"},lang:{type:String,default:"javascript"},theme:{type:String,default:"tomorrow"},sync:{type:Boolean,default:!0},editorClass:{type:String,default:"editor"},editorStyle:{type:String,default:""}},data:function(){return{editor:null,session:null}},methods:{insert(t){c=c||this.editor.selection.getRange(),c&&this.session.replace(c,t)},setAnnotations(t){this.session.setAnnotations(t)},clearAnnotations(){this.session.clearAnnotations()}},watch:{content:function(t){const e=this;c=this.editor.selection.getRange(),e.sync&&t!==e.session.getValue()&&e.editor.setValue(t,1)},theme:function(t){const e=this;e.editor.setTheme("ace/theme/"+t)}},mounted(){const t=this;var e=t.lang,i=t.theme,s=t.editor=window.ace.edit(t.$el),a=t.session=s.getSession();s.$blockScrolling=1/0,a.setMode("ace/mode/"+e),s.setTheme("ace/theme/"+i),a.setValue(t.content,1),a.on("change",()=>{t.emit("editor-change-content",a.getValue(),t),t.$emit("change",a.getValue())}),s.selection.on("changeSelection",()=>{c=t.editor.selection.getRange().clone()}),this.$emit("mount",this)}},r=l,d=(i("7d38"),i("2877")),m=Object(d["a"])(r,s,a,!1,null,"e859eb34",null);e["default"]=m.exports},"6ca7":function(t,e,i){},"7d38":function(t,e,i){"use strict";i("d67e")},8142:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("v-card",{attrs:{flat:""}},[e("v-row",{staticClass:"mx-0"},[e("v-col",{attrs:{cols:"5"}},[t.form?e("dj-list",{attrs:{items:t.respondents,itemKey:"email",title:"Invited respondents",draggable:""},on:{select:t.onSelect,update:t.onUpdate},scopedSlots:t._u([{key:"menu",fn:function(){return[e("v-btn",{attrs:{icon:"",small:"",color:"primary--text",disabled:0==t.selection.length},on:{click:t.notifyUsers}},[e("v-icon",{staticClass:"primary--text"},[t._v("mdi-email-outline")])],1),e("v-divider",{staticClass:"mx-2",attrs:{vertical:""}}),e("v-btn",{attrs:{icon:"",small:"",color:"primary--text",disabled:!t.isValidEmail(t.searchEmail)},on:{click:function(e){return t.selectEmail(t.searchEmail)}}},[e("v-icon",{staticClass:"primary--text"},[t._v("mdi-plus")])],1),e("v-divider",{staticClass:"mx-2",attrs:{vertical:""}}),e("v-btn",{attrs:{icon:"",small:"",color:"primary--text",disabled:0==t.selection.length},on:{click:function(e){return t.deleteUsers(t.selection)}}},[e("v-icon",{staticClass:"primary--text"},[t._v("mdi-trash-can-outline")])],1)]},proxy:!0},{key:"no-data",fn:function(){return[e("span",{staticClass:"title warning--text font-weight-light"},[t._v("No invited respondents.")])]},proxy:!0},{key:"item",fn:function({item:i}){return[e("v-row",{staticClass:"mx-0 pa-0"},[e("v-col",{staticClass:"pa-0",attrs:{cols:"1"}},[i.photo?e("v-avatar",[e("dj-img",{attrs:{src:i.photo,icon:i.icon?i.icon:"mdi-account"}})],1):e("v-avatar",[e("v-icon",[t._v(" mdi-account-question-outline")])],1)],1),e("v-col",{staticClass:"py-0 mx-2 pl-5"},[e("div",{staticClass:"subtitle-2"},[t._v(t._s(i.name))]),e("div",{staticClass:"caption"},[t._v(t._s(i.email))]),i.apikey?e("div",{staticClass:"caption primary--text"},[t._v("apikey: "+t._s(i.apikey))]):t._e(),i.lastNotifiedAt?e("div",{staticClass:"caption"},[t._v("notified "+t._s(t.timeAgo(i.lastNotifiedAt)))]):t._e()])],1)]}},{key:"input",fn:function(){return[e("v-autocomplete",{attrs:{items:t.user_email_list,label:t.label,error:t.error,success:t.success,"search-input":t.searchEmail},on:{"update:searchInput":function(e){t.searchEmail=e},"update:search-input":function(e){t.searchEmail=e},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.selectEmail(t.searchEmail)},input:function(e){return t.addNewEmail(t.newEmail)}},scopedSlots:t._u([{key:"item",fn:function(i){return["object"!==typeof i.item?[e("v-list-item-title",[t._v(t._s(i.item))])]:[e("v-list-item-title",{domProps:{innerHTML:t._s(i.item)}})]]}}],null,!1,3514745523),model:{value:t.newEmail,callback:function(e){t.newEmail=e},expression:"newEmail"}},[e("template",{slot:"no-data"},[e("v-list-item",{on:{click:t.selectEmail}},[t._v('\n                Add foreign respondent: "'+t._s(t.searchEmail)+'"\n              ')])],1)],2)]},proxy:!0}],null,!1,749974867)}):t._e()],1),e("v-divider",{attrs:{vertical:""}}),e("v-col",[e("div",{staticClass:"primary--text font-weight-light title"},[t._v("Invitation template")]),e("editor",{staticStyle:{border:"1px solid #e0e0e0"},attrs:{content:t.form.config.access.notificationTemplate,lang:"html",sync:!0},on:{change:t.onUpdateSource}}),e("div",{staticClass:"primary--text font-weight-light title"},[t._v("Preview")]),e("v-flex",{staticClass:"pa-2",staticStyle:{border:"1px solid #e0e0e0"},attrs:{"xs-12":""},domProps:{innerHTML:t._s(t.preview)}})],1)],1)],1)},a=[],n=i("c555"),o=i("4e14"),c=i("c7cc"),l=i("3e31"),r=i("c1df"),d=i.n(r),m=i("a3d5"),h=i("2ef0");let u=(t,e)=>{h["templateSettings"].interpolate=/{{([\s\S]+?)}}/g;let i=Object(h["template"])(t)(e);return h["templateSettings"].interpolate=/<%=([\s\S]+?)%>/g,i};var p={mixins:[n["a"],o["a"],c["a"]],props:["form"],components:{editor:l["default"],"dj-list":m["a"]},computed:{respondents(){return this.form?this.form.config.access.users.map(t=>t):[]},user_email_list(){return Object(h["differenceWith"])(this.userlist,this.form.config.access.users,(t,e)=>t.email==e.email).map(t=>t.email)},preview(){let t={};t.metadata=this.form.metadata,t.respondent=this.selection.length>0?this.selection[0]:{name:"Dummy",email:"dummy@example.com",apikey:"dummy_apikey"},t.app=this.app;try{return u(this.form.config.access.notificationTemplate,t)}catch(e){return`<h2 class="error--text subheading">Cannot display preview</h2><p class="error--text caption">${e.toString()}</p>`}}},methods:{notifyUsers(){let t=this.selection.map(t=>{let e=JSON.parse(JSON.stringify(t));return e.context={metadata:this.form.metadata,respondent:t},e.lastNotifiedAt=new Date,e});this.sendMails(t,this.form.config.access.notificationTemplate).then(()=>{this.form.config.access.users.filter(t=>t.selected).forEach(t=>{t.lastNotifiedAt=new Date}),this.$emit("update",this.form.config.access)})},timeAgo(t){return d()(new Date(t)).fromNow()},isValidEmail(t){let e=/^([A-Z|a-z|0-9](\.|_){0,1})+[A-Z|a-z|0-9]@([A-Z|a-z|0-9])+((\.){0,1}[A-Z|a-z|0-9]){2}\.[a-z]{2,3}$/,i=e.test(t);return!!i},isUniqueEmail(t){let e=Object(h["findIndex"])(this.form.config.access.users,e=>e.email==t);return-1==e},selectEmail(){let t=this.isValidEmail(this.searchEmail);this.errorMessages=1==t?[]:t,t=this.isUniqueEmail(this.searchEmail),1!=t&&this.errorMessages.push(t),0==this.errorMessages.length?this.addNewEmail(this.searchEmail):this.cancelAddNewEmail()},addNewEmail(t){let e=Object(h["find"])(this.userlist,e=>e.email==t),i=!1;e||(e={name:t,email:t,apikey:this.apikey()},i=!0),this.form.config.access.users.push(e),this.$emit("update",this.form.config.access),i&&this.findUserProfile(e.email).then(t=>{if("none"==t.type){let t=Object(h["findIndex"])(this.form.config.access.users,t=>t.email==e.email);if(t>=0){let e=this.form.config.access.users.splice(t,1)[0];e.photo="./",e.icon="mdi-account-question-outline",this.form.config.access.users.push(e)}}else{let i=Object(h["findIndex"])(this.form.config.access.users,t=>t.email==e.email);if(i>=0){let e=this.form.config.access.users.splice(i,1)[0];e.photo=t.profile.photo,e.name=t.profile.name,e.icon="mdi-account-question-outline",this.form.config.access.users.push(e)}}}),this.newEmail=null,this.searchEmail=null,this.$emit("update",this.form.config.access)},apikey(){return Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)},deleteUsers(t){this.form.config.access.users=Object(h["differenceWith"])(this.form.config.access.users,t,(t,e)=>t.email==e.email),this.$emit("update",this.form.config.access)},selectUser(t){let e=Object(h["findIndex"])(this.form.config.access.users,e=>e.email==t.email);this.form.config.access.users.splice(e,1,t)},onSelect(t){this.selection=Object(h["intersectionWith"])(this.form.config.access.users,t,(t,e)=>t.email==e.email)},onUpdate(t){this.form.config.access.users=t.map(t=>t),this.$emit("update",this.form.config.access)},onUpdateSource(t){this.form.config.access.notificationTemplate=t,this.setNeedSave(!0)}},created(){this.$portal.get("/api/users/list").then(t=>{this.userlist=t.data.map(t=>(t.selected=!1,t))})},watch:{searchEmail(t){return t?this.isValidEmail(t)?this.isUniqueEmail(t)?(this.label="Add foreign respondent",this.error=!1,void(this.success=!0)):(this.label="Email doublicate detected",this.error=!0,void(this.success=!1)):(this.label="Invalid email format",this.error=!0,void(this.success=!1)):(this.label="Type or select respondent email",this.error=!1,void(this.success=!1))}},data:()=>({userlist:[],searchEmail:null,newEmail:null,errorMessages:[],label:"Type or select respondent email",error:!1,success:!1,selection:[]})},f=p,g=i("2877"),v=i("fef8"),y=i.n(v),x=i("c6a6"),b=i("8212"),_=i("8336"),S=i("b0af"),k=i("62ad"),C=i("ce7e"),w=i("0e8f"),E=i("132d"),I=i("da13"),V=i("5d23"),$=i("0fd9"),A=Object(g["a"])(f,s,a,!1,null,null,null);e["default"]=A.exports;y()(A,{VAutocomplete:x["a"],VAvatar:b["a"],VBtn:_["a"],VCard:S["a"],VCol:k["a"],VDivider:C["a"],VFlex:w["a"],VIcon:E["a"],VListItem:I["a"],VListItemTitle:V["c"],VRow:$["a"]})},a3d5:function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return t.items_?e("div",[e("v-col",{staticClass:"pa-0"},[e("v-row",{staticClass:"mx-0 px-2"},[e("div",{staticClass:"primary--text font-weight-light title"},[t._v(t._s(t.title))])]),0==t.items_.length?e("v-row",{staticClass:"d-flex justify-center py-3"},[t._t("no-data")],2):e("div",[t.draggable_?e("v-container",{attrs:{"mt-2":""}},[e("v-row",{staticStyle:{"border-bottom":"1px solid #dedede !important"}},[e("v-col",{staticClass:"py-1 px-5 mx-1",attrs:{cols:"2"}},[e("v-checkbox",{staticStyle:{margin:"0",padding:"0"},attrs:{color:"secondary lighten-3","hide-details":"",indeterminate:t.indeterminate},on:{change:function(e){return t.selectGroup()}},model:{value:t.allSelected,callback:function(e){t.allSelected=e},expression:"allSelected"}})],1),e("v-spacer"),t._t("menu")],2),e("draggable",{staticClass:"list-group",attrs:{element:"div",options:t.dragOptions,move:t.onMove},on:{start:t.onStartDrag,end:t.onEndDrag},model:{value:t.items_,callback:function(e){t.items_=e},expression:"items_"}},[e("transition-group",{attrs:{type:"transition",name:t.title,tag:"div"}},t._l(t.items_,(function(i){return e("v-row",{key:i[t.itemKey],staticClass:"list-group-item",staticStyle:{"padding-bottom":"0.5em","border-bottom":"1px solid #e0e0e0"}},[e("v-col",{staticClass:"py-1",staticStyle:{margin:"auto"},attrs:{cols:"2"}},[e("v-row",[e("v-icon",{staticClass:"handle"},[t._v("more_vert")]),e("v-checkbox",{staticStyle:{margin:"0",padding:"0"},attrs:{color:"secondary lighten-3","hide-details":""},on:{change:function(e){return t.select()}},model:{value:i.selected,callback:function(e){t.$set(i,"selected",e)},expression:"item.selected"}})],1)],1),e("v-col",{staticClass:"py-1"},[t._t("item",null,{item:i})],2)],1)})),1)],1)],1):e("v-container",{attrs:{"mt-2":""}},[e("v-row",{staticStyle:{"border-bottom":"1px solid #dedede !important"}},[e("v-col",{staticClass:"py-1 px-5 ml-3",attrs:{cols:"2"}},[e("v-checkbox",{staticStyle:{margin:"0",padding:"0"},attrs:{secondary:"","hide-details":"",indeterminate:t.indeterminate},on:{change:function(e){return t.selectGroup()}},model:{value:t.allSelected,callback:function(e){t.allSelected=e},expression:"allSelected"}})],1),e("v-spacer"),t._t("menu")],2),t._l(t.items_,(function(i){return e("div",{key:i[t.itemKey]},[e("v-row",{staticClass:"mx-0 px-2"},[e("v-col",{staticClass:"py-1",staticStyle:{margin:"auto"},attrs:{cols:"1"}},[e("v-checkbox",{staticStyle:{margin:"0",padding:"0"},attrs:{secondary:"","hide-details":""},on:{change:function(e){return t.select()}},model:{value:i.selected,callback:function(e){t.$set(i,"selected",e)},expression:"item.selected"}})],1),e("v-col",{staticClass:"py-1"},[t._t("item",null,{item:i})],2)],1),e("v-divider")],1)}))],2)],1)],1),e("v-row",{staticClass:"mx-0"},[t._t("input")],2)],1):t._e()},a=[],n=i("c555"),o=i("b76a"),c=i.n(o),l={mixins:[n["a"]],props:["title","items","itemKey","maxLength","fixedLength","draggable"],components:{draggable:c.a},computed:{indeterminate(){return!this.items_||0!=this.selection.length&&this.selection.length<this.items_.$Zlength},dragOptions(){return{animation:150,group:{name:this.title},ghostClass:"ghost",dragClass:"drag",handle:".handle"}}},methods:{onStartDrag(){this.isDragging=!0},onEndDrag(){this.isDragging=!1,this.$emit("update",this.items_)},onMove(){return!0},select(){this.selection=this.items_?this.items_.filter(t=>t.selected):[],this.$emit("select",this.selection)},selectGroup(){this.allSelected?this.items_.forEach(t=>{t.selected=!0}):this.items_.forEach(t=>{t.selected=!1}),this.select()}},data:()=>({selection:[],allSelected:!1,items_:[]}),watch:{items:{handler(t){t?setTimeout(()=>{this.items_=t.map(t=>t)},20):this.items_=[]},deep:!0},selection:{handler(t){this.allSelected=t.length==this.items_.length},deep:!0}},created(){this.draggable_=!(!this.draggable&&""!=this.draggable),this.maxLength_=this.maxLength&&""!=this.draggable?this.maxLength:Number.POSITIVE_INFINITY,this.items_=this.items.map(t=>t)}},r=l,d=(i("c902"),i("2877")),m=i("fef8"),h=i.n(m),u=i("ac7c"),p=i("62ad"),f=i("a523"),g=i("ce7e"),v=i("132d"),y=i("0fd9"),x=i("2fa4"),b=Object(d["a"])(r,s,a,!1,null,"1bc693be",null);e["a"]=b.exports;h()(b,{VCheckbox:u["a"],VCol:p["a"],VContainer:f["a"],VDivider:g["a"],VIcon:v["a"],VRow:y["a"],VSpacer:x["a"]})},ac7c:function(t,e,i){"use strict";i("6ca7"),i("ec29");var s=i("9d26"),a=i("c37a"),n=i("fe09");e["a"]=n["a"].extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...a["a"].options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(t){this.$nextTick(()=>this.inputIndeterminate=t)},inputIndeterminate(t){this.$emit("update:indeterminate",t)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:t,...e}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(s["a"],this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...e,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}})},c902:function(t,e,i){"use strict";i("2751")},d67e:function(t,e,i){}}]);
//# sourceMappingURL=chunk-e803df42.3f0627d6.js.map