(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c022d14","chunk-c2702fe6"],{"2b5d":function(t,e,n){"use strict";n("2bfd");var i=n("b974"),s=n("c6a6"),a=n("80d2");e["a"]=s["a"].extend({name:"v-combobox",props:{delimiters:{type:Array,default:()=>[]},returnObject:{type:Boolean,default:!0}},data:()=>({editingIndex:-1}),computed:{computedCounterValue(){return this.multiple?this.selectedItems.length:(this.internalSearch||"").toString().length},hasSlot(){return i["a"].options.computed.hasSlot.call(this)||this.multiple},isAnyValueAllowed(){return!0},menuCanShow(){return!!this.isFocused&&(this.hasDisplayedItems||!!this.$slots["no-data"]&&!this.hideNoData)},searchIsDirty(){return null!=this.internalSearch}},methods:{onInternalSearchChanged(t){if(t&&this.multiple&&this.delimiters.length){const e=this.delimiters.find(e=>t.endsWith(e));null!=e&&(this.internalSearch=t.slice(0,t.length-e.length),this.updateTags())}this.updateMenuDimensions()},genInput(){const t=s["a"].options.methods.genInput.call(this);return delete t.data.attrs.name,t.data.on.paste=this.onPaste,t},genChipSelection(t,e){const n=i["a"].options.methods.genChipSelection.call(this,t,e);return this.multiple&&(n.componentOptions.listeners={...n.componentOptions.listeners,dblclick:()=>{this.editingIndex=e,this.internalSearch=this.getText(t),this.selectedIndex=-1}}),n},onChipInput(t){i["a"].options.methods.onChipInput.call(this,t),this.editingIndex=-1},onEnterDown(t){t.preventDefault(),this.getMenuIndex()>-1||this.$nextTick(this.updateSelf)},onKeyDown(t){const e=t.keyCode;!t.ctrlKey&&[a["z"].home,a["z"].end].includes(e)||i["a"].options.methods.onKeyDown.call(this,t),this.multiple&&e===a["z"].left&&0===this.$refs.input.selectionStart?this.updateSelf():e===a["z"].enter&&this.onEnterDown(t),this.changeSelectedIndex(e)},onTabDown(t){if(this.multiple&&this.internalSearch&&-1===this.getMenuIndex())return t.preventDefault(),t.stopPropagation(),this.updateTags();s["a"].options.methods.onTabDown.call(this,t)},selectItem(t){this.editingIndex>-1?this.updateEditing():(s["a"].options.methods.selectItem.call(this,t),this.internalSearch&&this.multiple&&this.getText(t).toLocaleLowerCase().includes(this.internalSearch.toLocaleLowerCase())&&(this.internalSearch=null))},setSelectedItems(){null==this.internalValue||""===this.internalValue?this.selectedItems=[]:this.selectedItems=this.multiple?this.internalValue:[this.internalValue]},setValue(t){i["a"].options.methods.setValue.call(this,void 0===t?this.internalSearch:t)},updateEditing(){const t=this.internalValue.slice(),e=this.selectedItems.findIndex(t=>this.getText(t)===this.internalSearch);if(e>-1){const n="object"===typeof t[e]?Object.assign({},t[e]):t[e];t.splice(e,1),t.push(n)}else t[this.editingIndex]=this.internalSearch;this.setValue(t),this.editingIndex=-1,this.internalSearch=null},updateCombobox(){if(!this.searchIsDirty)return;this.internalSearch!==this.getText(this.internalValue)&&this.setValue();const t=Boolean(this.$scopedSlots.selection)||this.hasChips;t&&(this.internalSearch=null)},updateSelf(){this.multiple?this.updateTags():this.updateCombobox()},updateTags(){const t=this.getMenuIndex();if(t<0&&!this.searchIsDirty||!this.internalSearch)return;if(this.editingIndex>-1)return this.updateEditing();const e=this.selectedItems.findIndex(t=>this.internalSearch===this.getText(t)),n=e>-1&&"object"===typeof this.selectedItems[e]?Object.assign({},this.selectedItems[e]):this.internalSearch;if(e>-1){const t=this.internalValue.slice();t.splice(e,1),this.setValue(t)}if(t>-1)return this.internalSearch=null;this.selectItem(n),this.internalSearch=null},onPaste(t){var e;if(this.$emit("paste",t),!this.multiple||this.searchIsDirty)return;const n=null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text/vnd.vuetify.autocomplete.item+plain");n&&-1===this.findExistingIndex(n)&&(t.preventDefault(),i["a"].options.methods.selectItem.call(this,n))},clearableCallback(){this.editingIndex=-1,s["a"].options.methods.clearableCallback.call(this)}}})},"36ae":function(t,e,n){"use strict";n("7d82")},"3c5a":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"echart",style:t.style})},s=[],a=n("313e"),o=n("4e14"),r={name:"echart",mixins:[o["a"]],computed:{style(){return{height:(this.height||250)+"px"}}},methods:{initChart(t){this.chart=a["init"](this.$el,null,{height:this.height,width:"auto"}),this.resizeHandler=()=>{this.width=this.$el.clientWidth,this.chart.resize()},window.attachEvent?window.attachEvent("onresize",this.resizeHandler):window.addEventListener("resize",this.resizeHandler),t&&setTimeout(()=>{this.chart.setOption(t),this.chart.on("click",t=>{this.$emit("chart-event",t)})},10),this.on({event:"slide-start",callback:()=>{setTimeout(()=>{this.chart&&this.options&&this.chart.setOption(this.options,!0),this.chart.resize()},10)},rule:()=>!0}),this.on({event:"update-dialog-view",callback:()=>{setTimeout(()=>{this.chart&&this.options&&this.chart.setOption(this.options,!0),this.chart.resize()},10)},rule:()=>!0})}},props:["options","height"],watch:{options:{handler:function(t){t&&this.chart&&setTimeout(()=>{this.chart.setOption(t,!0),this.chart.resize()},10)},deep:!0},height(t){setTimeout(()=>{this.chart.resize({height:t},10)})}},mounted(){this.initChart(this.options)},beforeDestroy(){window.attachEvent?window.detachEvent("onresize",this.resizeHandler):window.removeEventListener("resize",this.resizeHandler,!1),this.off()},data:()=>({chart:null,resizeHandler:null})},c=r,l=(n("36ae"),n("2877")),d=Object(l["a"])(c,i,s,!1,null,"7d96c1a5",null);e["default"]=d.exports},"7d82":function(t,e,n){},"81c2":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[t.error1||t.error2||t.error3||!t.options?e("v-layout",[e("v-flex",{attrs:{xs12:""}},[e("h2",{staticClass:"warning--text font-weight-light headline"},[t._v(t._s(t.message))])])],1):e("div",[t.indicators&&t.countries&&t.years?e("v-layout",{attrs:{column:""}},[e("v-flex",{attrs:{xs12:""}},[e("v-layout",{attrs:{column:"","justify-center":""}},[e("h3",{staticClass:"primary--text body-2 pt-2 pb-0",staticStyle:{"text-align":"center"}},[t._v("\n            "+t._s(t.config.title)+"\n          ")]),t.options?e("p",{staticClass:"caption font-italic font-weight-light ma-0 pa-0",staticStyle:{"text-align":"center"}},[t._v("\n            "+t._s(t.config.note)+"\n          ")]):t._e()])],1),e("v-flex",{attrs:{xs12:""}},[e("v-layout",{staticClass:"mx-0 px-1",attrs:{row:""}},[e("v-flex",{attrs:{xs4:"","pr-1":"","pl-1":""}},[this.config.dataSelectEmitters&&0!=this.config.dataSelectEmitters.length?t._e():e("v-autocomplete",{staticClass:"caption",attrs:{items:t.countries,"item-text":"name",color:"primary",filter:t.filter,label:"Select entity",multiple:""},model:{value:t.country_selection,callback:function(e){t.country_selection=e},expression:"country_selection"}})],1),e("v-flex",{attrs:{xs6:"","pr-1":"","pl-1":""}},[e("v-autocomplete",{staticClass:"caption",attrs:{items:t.indicators,"item-text":"name","item-value":"concept",color:"primary",filter:t.filter,label:"Select indicator"},model:{value:t.indicator_select,callback:function(e){t.indicator_select=e},expression:"indicator_select"}})],1),e("v-flex",{attrs:{xs2:"","pr-1":"","pl-1":""}},[e("v-combobox",{staticClass:"caption",attrs:{items:t.years,label:"Select year"},model:{value:t.year_select,callback:function(e){t.year_select=e},expression:"year_select"}})],1)],1)],1),e("v-flex",{staticStyle:{border:"1px solid #dedede",background:"#ffffff"},attrs:{xs12:""}},[t.options?e("echart",{attrs:{options:t.chartOptions,height:t.options.widget.height}}):t._e()],1)],1):t._e()],1)],1)},s=[],a=n("c555"),o=n("4e14"),r={methods:{getIndicatorList(t){return new Promise((e,n)=>{this.$dps.run({script:`\n\t\t\t\t\t\t<?javascript\n\t\t\t\t\t\t    $scope.mapper = d => ({\n\t\t\t\t\t\t        concept: d.value.concept,\n\t\t\t\t\t\t        name: d.value.name,\n\t\t\t\t\t\t        type: d.value.type\n\t\t\t\t\t\t    });\n\t\t\t\t\t\t?>\n\t\t\t\t\t\tdml.select(from:"${t}", map:{{mapper}})\n\t\t\t\t\t\tc.order(by:"type")\n\t\t\t\t\t`}).then(t=>{"error"==t.type?n(t.data):e(t.data)})})},getYearList(t,e,n){return new Promise((i,s)=>{this.$dps.run({script:`\n\t\t\t\t\t\t<?javascript\n\t\t\t\t\t\t    // input parameters\n\t\t\t\t\t\t    \n\t\t\t\t\t\t    $scope.rootConcept = "${t}";\n\t\t\t\t\t\t    $scope.conceptFilter = d => d.value.concept == $scope.rootConcept\n\t\t\t\t\t\t    $scope.collectionFilter = d => d.value.def == "${e}."+ $scope.rootConcept;\n\t\t\t\t\t\t    \n\t\t\t\t\t\t?>\n\n\t\t\t\t\t\tdml.select(from:"${e}", return:"value", where:{{conceptFilter}})\n\t\t\t\t\t\tset("indicator")\n\n\t\t\t\t\t\tdml.select(from:"${n}", return:"value", where:{{collectionFilter}})\n\t\t\t\t\t\tset("collection")\n\n\t\t\t\t\t\t<?javascript\n\t\t\t\t\t\t    $scope.dataCollection = $scope.collection[0].concept.split(".")[0];\n\t\t\t\t\t\t?>\n\n\t\t\t\t\t\tdml.select(from:{{dataCollection}}, return: "value")\n\t\t\t\t\t\tc.unique("year")\n\t\t\t\t\t\tc.order()\n\t\t\t\t\t`}).then(t=>{"error"==t.type?s(t.data):i(t.data)})})},getCountryList(t,e,n,i){return new Promise((s,a)=>{this.$dps.run({script:`\n\t\t\t\t\t\t<?javascript\n\t\t\t\t\t\t    // input parameters\n\t\t\t\t\t\t    \n\t\t\t\t\t\t    $scope.rootConcept = "${t}";\n\t\t\t\t\t\t    $scope.conceptFilter = d => d.value.concept == $scope.rootConcept\n\t\t\t\t\t\t    $scope.collectionFilter = d => d.value.def == "${e}."+ $scope.rootConcept;\n\t\t\t\t\t\t    \n\t\t\t\t\t\t?>\n\n\t\t\t\t\t\tdml.select(from:"${e}", return:"value", where:{{conceptFilter}})\n\t\t\t\t\t\tset("indicator")\n\n\t\t\t\t\t\tdml.select(from:"${n}", return:"value", where:{{collectionFilter}})\n\t\t\t\t\t\tset("collection")\n\n\t\t\t\t\t\t<?javascript\n\t\t\t\t\t\t    $scope.dataCollection = $scope.collection[0].concept.split(".")[0];\n\t\t\t\t\t\t    \n\t\t\t\t\t\t    $scope.joinOn = (a, b) => a == b["${this.config.metadata.mapper.id}"]\n\t\t\t\t\t\t    $scope.joinMapper = d => ({\n\t\t\t\t\t\t        id: d.left,\n\t\t\t\t\t\t        name: d.right["${this.config.metadata.mapper.name}"]\n\t\t\t\t\t\t    });\n\t\t\t\t\t\t?>\n\n\t\t\t\t\t\tdml.select(from:"${i}", return:"value")\n\t\t\t\t\t\tset("countries")\n\n\t\t\t\t\t\tdml.select(from:{{dataCollection}}, return: "value")\n\t\t\t\t\t\tc.unique("${this.config.metadata.mapper.id}")\n\n\t\t\t\t\t\tc.innerJoin(with:{{countries}}, on:{{joinOn}})\n\n\t\t\t\t\t\tc.map({{joinMapper}})\n\t\t\t\t\t\tc.order(by:"name")\n\t\t\t\t\t`}).then(t=>{"error"==t.type?a(t.data):s(t.data)})})},getTree(t,e,n,i){return this.$dps.run({script:`\n\t\t\t\t\t<?javascript\n\t\t\t\t    // input parameters\n\t\t\t\t\t    $scope.rootConcept = "${t}";\n\t\t\t\t\t    \n\t\t\t\t\t    $scope.filters = ${JSON.stringify(i)}\n\t\t\t\t\n\t\t\t\t\t?>\n\t\t\t\t\t\n\n\t\t\t\t\tdml.select(from:"${e}", return:"value")\n\t\t\t\t\tset("indicators")\n\t\t\t\t\t\n\t\t\t\t\tdml.select(from:"${n}", return:"value")\n\t\t\t\t\tset("collections")\n\n\t\t\t\t\t<?javascript\n\t\t\t\t\t    $scope.datapoints = []\n\n\t\t\t\t\t    let getTree = concept => {\n\t\t\t\t\t        \n\t\t\t\t\t        let f = _.find($scope.indicators,d => d.concept == concept)\n\t\t\t\t\t        let children = (f && f.args) ? f.args.split(",").map(d => d.trim()) :[]\n\t\t\t\t\t        let datapoint = _.find($scope.collections, c => c.def && c.def.split(".")[1] == concept )\n\t\t\t\t\t        let names = []\n\t\t\t\t\t        \n\t\t\t\t\t        if(datapoint){\n\t\t\t\t\t            names = datapoint.concept.split(".")  \n\t\t\t\t\t            $scope.datapoints.push({\n\t\t\t\t\t                collection: names[0],\n\t\t\t\t\t                field: names[1]\n\t\t\t\t\t            })\n\t\t\t\t\t        }\n\t\t\t\t\t        \n\t\t\t\t\t        return {\n\t\t\t\t\t            concept: concept,\n\t\t\t\t\t            name: (f) ? f.name : "n/a",\n\t\t\t\t\t            range:(f) ? f.range : "n/a",\n\t\t\t\t\t            datapoint: {\n\t\t\t\t\t                collection: names[0],\n\t\t\t\t\t                field: names[1]\n\t\t\t\t\t            },\n\t\t\t\t\t            children : children.map(getTree)\n\t\t\t\t\t        }\n\t\t\t\t\t    };\n\t\t\t\t\t    \n\t\t\t\t\t    $scope.res = getTree($scope.rootConcept);\n\t\t\t\t\t    \n\t\t\t\t\t    $scope.valuesScript = $scope.datapoints.map( d => \n\t\t\t\t\t    'dml.select(from:"'+d.collection+'",return:"value"); set("data.'+d.collection+'");').join("")+"return('data')"\n\t\t\t\t\t \n\n\t\t\t\t\t?>\n\t\t\t\t\trun({{valuesScript}})\n\t\t\t\t\tset("data")\n\n\t\t\t\t\t<?javascript\n\t\t\t\t\t    \n\t\t\t\t\t    \n\t\t\t\t\t    let findValues = node => {\n\t\t\t\t\t        \n\t\t\t\t\t        if(node.datapoint.collection){\n\t\t\t\t\t            \n\t\t\t\t\t            node.values = \n\t\t\t\t\t            $scope.filters.map( f => {\n\t\t\t\t\t                let r = Object.assign({}, f)\n\t\t\t\t\t                let founded = _.find($scope.data[node.datapoint.collection], f)\n\t\t\t\t\t                if(founded){\n\t\t\t\t\t                    \n\t\t\t\t\t                    r["${this.config.metadata.mapper.id}"] = undefined\n\t\t\t\t\t                    r.id = founded["${this.config.metadata.mapper.id}"]\n\t\t\t\t\t                    r.value = founded[node.datapoint.field] || "n/a"\n\t\t\t\t\t                   \n\t\t\t\t\t                } \n\t\t\t\t\t                return r\n\t\t\t\t\t            })\n\t\t\t\t\t            \n\t\t\t\t\t        }\n\t\t\t\t\t        \n\t\t\t\t\t        if(node.children){\n\t\t\t\t\t            node.children.forEach( c => {findValues(c)})\n\t\t\t\t\t        }\n\t\t\t\t\t    };\n\t\t\t\t\t    \n\t\t\t\t\t    res = findValues($scope.res);\n\t\t\t\t\t?>\n\n\t\t\t\t\treturn ("res")\n\t\t\t\t`}).then(t=>t.data)}}},c=function(){var t=this,e=t._self._c;return e("config-dialog",{attrs:{options:t.props,submit:t.submit}})},l=[],d=n("a410"),h={name:"DataExplorerConfig",components:{"config-dialog":d["a"]},props:["options","submit"],computed:{props(){return{icon:this.options.config.icon,title:`data-explorer-widget: ${this.options.config.id} ${this.options.config.name}`,config:this.options.config,editorTree:this.editorTree}}},data(){return{editorTree:[{name:"Configuration",children:[{name:"Widget",editor:()=>n.e("chunk-2d226cca").then(n.bind(null,"e9cc"))},{name:"Metadata",editor:()=>n.e("chunk-2d2370f2").then(n.bind(null,"fa01"))},{name:"Data management",editor:()=>Promise.all([n.e("chunk-3faa419a"),n.e("chunk-7bec71d0")]).then(n.bind(null,"afef"))},{name:"Decoration",editor:()=>n.e("chunk-2d0b6a9f").then(n.bind(null,"1db8"))}]}]}}},p=h,u=n("2877"),m=Object(u["a"])(p,c,l,!1,null,null,null),f=m.exports,g=n("3c5a"),v=n("2ef0"),y={name:"ds-value-explorer-widget",icon:"mdi-triforce",mixins:[a["a"],o["a"],r],components:{echart:g["default"]},computed:{chartOptions(){if(!this.options)return{};let t=JSON.parse(JSON.stringify(this.options));return t.series[0].label.normal.formatter=t=>{let e=`{title|${t.data.name}}\n`;if(t.data.values){let n=t.data.range?t.data.range.split(",").map(t=>Number.parseFloat(t.trim())):void 0,i=t.data.values.map(t=>{let e="norange";if(n&&"n/a"!=t.value){let i;i=n[1]-n[0]>=0?(t.value-n[0])/(n[1]-n[0]):-(t.value-n[1])/(n[0]-n[1]),e=i>=0?i<=.25?"low":i>=.75?"high":"middle":i<=-.75?"low":i>=-.25?"high":"middle"}let i=Object.keys(t).map(e=>"value"==e?"n/a"==t[e]?t[e]:Number.parseFloat(t[e]).toFixed(3):"id"==e?this.getName(t[e]):t[e]).join("\t\t\t");return`{${e}|${i}}`}).join("\n");e+=i}return e},t}},methods:{getName(t){let e=Object(v["find"])(this.countries,e=>e.id==t);return e?e.name:e},remove(t){if(1==this.country_selection.length)return;const e=this.country_selection.indexOf(t);e>=0&&this.country_selection.splice(e,1)},updateOptions({data:t,options:e}){if(!t)return;const n=JSON.parse(JSON.stringify(e));this.data=t,n.series[0].data=[t],this.options=n},onUpdate({data:t,options:e}){this.updateOptions({data:this.data,options:this.config.options})},filter(t,e){return Object(v["includes"])(t.name?t.name.toLowerCase():"",e?e.toLowerCase():"")},onReconfigure(t){return this.$dialogManager.showAndWait(f,{width:"80%"},{config:t})},onSlideStart(t){t._updateConfig()},onDataSelect(t,e){this.country_selection=e.selection.filter(t=>t.selected).map(t=>({id:t.entity.id,name:t.entity.title}))},loadTree(){this.indicator_select&&0!=this.country_selection.length&&this.year_select&&this.config.metadata.concepts&&this.config.metadata.countries&&this.config.metadata.collections&&(this.msg=this.progress({text:`Loading tree for ${this.indicator_select}...`}),this.getTree(this.indicator_select,this.config.metadata.concepts,this.config.metadata.collections,this.country_selection.map(t=>{let e={};return e[this.config.metadata.mapper.id]=Object(v["find"])(this.countries,e=>e.name==t).id,e.year=this.year_select,e})).then(t=>{this.msg.cancel(),this.updateOptions({data:t,options:this.config.options})}))},initiate(){this.config.metadata.concepts&&this.config.metadata.collections&&this.config.metadata.countries&&(this.message="Loading...",this.getIndicatorList(this.config.metadata.concepts).then(t=>{this.indicators=t,this.indicator_select=t[0].concept,this.error1=!1,this.getCountryList(this.indicator_select,this.config.metadata.concepts,this.config.metadata.collections,this.config.metadata.countries).then(t=>{this.error2=!1,this.countries=t,this.config.dataSelectEmitters&&0!=this.config.dataSelectEmitters.length||(this.country_selection=[t[0].name])}).catch(()=>{this.error2=!0,this.message=`Entities definition "${this.config.metadata.countries}" or definition of dataset collections "${this.config.metadata.collections}" not found`}),this.getYearList(this.indicator_select,this.config.metadata.concepts,this.config.metadata.collections).then(t=>{this.error3=!1,this.years=t,this.year_select=t[0]}).catch(()=>{this.error3=!0,this.message=`Definition of dataset collections "${this.config.metadata.collections}" not found`})}).catch(()=>{this.error1=!0,this.message=`Dataset concepts definition "${this.config.metadata.concepts}" not found`}))}},props:["config"],mounted(){this.$emit("init")},watch:{indicator_select(){this.loadTree()},country_selection(){this.loadTree()},year_select(){this.loadTree()},"config.options.widget.height"(){this.$nextTick(()=>{this.updateOptions({data:this.data,options:this.config.options})})},"config.metadata":{handler(){this.$nextTick(()=>{this.initiate()})},deep:!0}},created(){this.initiate()},data:()=>({options:null,error1:!0,error2:!0,error3:!0,message:"No data available",selection:[],series:[],indicator_select:null,country_selection:[],year_select:null,indicators:null,countries:null,years:null,indicator_filter:"",completed:!1})},$=y,x=n("fef8"),b=n.n(x),w=n("c6a6"),S=n("2b5d"),_=n("0e8f"),C=n("a722"),I=Object(u["a"])($,i,s,!1,null,null,null);e["default"]=I.exports;b()(I,{VAutocomplete:w["a"],VCombobox:S["a"],VFlex:_["a"],VLayout:C["a"]})}}]);
//# sourceMappingURL=chunk-2c022d14.b18f67b6.js.map