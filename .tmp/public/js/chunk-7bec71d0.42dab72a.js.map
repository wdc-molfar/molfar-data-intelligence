{"version":3,"sources":["webpack:///./node_modules/vuetify/lib/components/VGrid/VContainer.js","webpack:///./src/components/widgets/ds-share/dataset-management.vue?db9e","webpack:///./src/components/widgets/ds-share/ds-io.mixin.js","webpack:///src/components/widgets/ds-share/dataset-management.vue","webpack:///./src/components/widgets/ds-share/dataset-management.vue?ea0e","webpack:///./src/components/widgets/ds-share/dataset-management.vue"],"names":["extend","name","functional","props","id","String","tag","type","default","fluid","Boolean","h","data","children","classes","attrs","Object","keys","filter","key","value","startsWith","domProps","staticClass","class","Array","concat","render","_vm","this","_c","_self","_v","_s","message","on","$event","uploadCollections","collections","_e","length","staticStyle","_l","c","cIndex","select","selected","exportCollection","sampleTable","headers","rows","Number","POSITIVE_INFINITY","scopedSlots","_u","fn","item","rowIndex","col","index","staticRenderFns","methods","$dps","run","script","then","res","getBaseURL","url","concept","Promise","resolve","reject","file","state","_","isString","mixins","dpsDownloadCollection","window","location","href","dpsLoadSchema","catch","selectFile","resolveFile","selectFileDialog","sample","dpsUploadCollections","messages","map","m","JSON","parse","stringify","join","$djvue","warning","title","text","loadCollections","e","toString","computed","dataset","dimensions","align","source","watch","newValue","dpsLoadCollectionSample","component","VBtn","VContainer","VDataTable","VDivider","VFlex","VIcon","VLayout","VProgressCircular","VRow","VSpacer"],"mappings":"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","file":"js/chunk-7bec71d0.42dab72a.js","sourcesContent":["import \"../../../src/components/VGrid/_grid.sass\";\nimport \"../../../src/components/VGrid/VGrid.sass\";\nimport Grid from './grid';\nimport mergeData from '../../util/mergeData';\n/* @vue/component */\n\nexport default Grid('container').extend({\n  name: 'v-container',\n  functional: true,\n  props: {\n    id: String,\n    tag: {\n      type: String,\n      default: 'div'\n    },\n    fluid: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  render(h, {\n    props,\n    data,\n    children\n  }) {\n    let classes;\n    const {\n      attrs\n    } = data;\n\n    if (attrs) {\n      // reset attrs to extract utility clases like pa-3\n      data.attrs = {};\n      classes = Object.keys(attrs).filter(key => {\n        // TODO: Remove once resolved\n        // https://github.com/vuejs/vue/issues/7841\n        if (key === 'slot') return false;\n        const value = attrs[key]; // add back data attributes like data-test=\"foo\" but do not\n        // add them as classes\n\n        if (key.startsWith('data-')) {\n          data.attrs[key] = value;\n          return false;\n        }\n\n        return value || typeof value === 'string';\n      });\n    }\n\n    if (props.id) {\n      data.domProps = data.domProps || {};\n      data.domProps.id = props.id;\n    }\n\n    return h(props.tag, mergeData(data, {\n      staticClass: 'container',\n      class: Array({\n        'container--fluid': props.fluid\n      }).concat(classes || [])\n    }), children);\n  }\n\n});\n//# sourceMappingURL=VContainer.js.map","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[(_vm.message)?_c('v-container',[_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h2',{staticClass:\"warning--text font-weight-light headline\"},[_vm._v(_vm._s(_vm.message))])]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.uploadCollections()}}},[_vm._v(\"Upload collections...\")])],1):_c('v-container',{attrs:{\"pa-0\":\"\"}},[(!_vm.collections)?_c('v-row',{staticClass:\"mx-0\"},[_c('v-progress-circular',{attrs:{\"indeterminate\":\"\",\"color\":\"primary\"}})],1):_vm._e(),(_vm.collections)?_c('v-layout',{attrs:{\"column\":\"\"}},[(_vm.collections)?_c('div',[_c('v-row',{staticClass:\"mx-0\",attrs:{\"align-center\":\"\"}},[_c('h3',{staticClass:\"primary--text font-weight-light subheading\"},[_vm._v(\"\\n            Schema: \\\"dj-data\\\" ( \"+_vm._s(_vm.collections.length)+\" items )\\n          \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.uploadCollections()}}},[_vm._v(\"Upload collections...\")])],1),_c('v-flex',{staticStyle:{\"max-height\":\"10em\",\"overflow\":\"auto\",\"border\":\"1px solid #dedede\"},attrs:{\"xs12\":\"\",\"pa-2\":\"\"}},_vm._l((_vm.collections),function(c,cIndex){return _c('v-row',{key:cIndex,staticClass:\"pt-2 mx-0\",staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){return _vm.select(c)}}},[_c('v-icon',{staticClass:\"body-1 pr-2\",class:(_vm.selected && c == _vm.selected) ? 'primary--text' : 'secondary--text font-weight-light'},[_vm._v(\"\\n              mdi-grid-large\\n            \")]),_c('h3',{staticClass:\"body-1\",class:(_vm.selected && c == _vm.selected) ? 'primary--text' : 'secondary--text font-weight-light'},[_vm._v(\"\\n              \"+_vm._s(c)+\"\\n            \")])],1)}),1)],1):_vm._e(),(_vm.sampleTable)?_c('div',[_c('v-flex',{attrs:{\"xs12\":\"\",\"pa-2\":\"\"}},[_c('v-layout',{attrs:{\"row\":\"\",\"align-center\":\"\"}},[_c('h3',{staticClass:\"primary--text subheading font-weight-light\"},[_vm._v(\"\\n              Sample from \\\"\"+_vm._s(_vm.selected)+\"\\\"\\n            \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.exportCollection(_vm.selected)}}},[_vm._v(\"Download\")])],1),_c('v-data-table',{staticStyle:{\"display\":\"inline-grid\"},attrs:{\"headers\":_vm.sampleTable.headers,\"items\":_vm.sampleTable.rows,\"dense\":\"\",\"calculate-widths\":\"\",\"items-per-page\":Number.POSITIVE_INFINITY,\"hide-default-footer\":\"\",\"height\":\"300px\",\"fixed-header\":\"\"},scopedSlots:_vm._u([{key:\"header\",fn:function(props){return [_c('td',{attrs:{\"colspan\":_vm.sampleTable.headers.length}},[_c('v-divider')],1)]}},{key:\"body\",fn:function(props){return [_c('tbody',_vm._l((props.items),function(item,rowIndex){return _c('tr',{key:rowIndex},_vm._l((_vm.sampleTable.headers),function(col,index){return _c('td',{key:index,staticClass:\"caption\"},[_vm._v(\"\\n                    \"+_vm._s(item[col.value])+\"\\n                  \")])}),0)}),0)]}}],null,false,3181246690)})],1)],1):_vm._e()]):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default {\r\n  methods: {\r\n\r\n    dpsDownloadCollection(c) {\r\n      return this.$dps.run({\r\n          script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => {\r\n\t\t\t\t\t        let res = d.value;\r\n\t\t\t\t\t        res.id = d.id\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tdml.select(from:\"${c}\", map:{{mapper}})\r\n\t\t\t\t\tset(\"data\")\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.attr = $scope.data.map( d => Object.keys(d));\r\n\t\t\t\t\t    $scope.field = [];\r\n\t\t\t\t\t    $scope.attr.forEach( a => {\r\n\t\t\t\t\t        $scope.field = _.union($scope.field,a)\r\n\t\t\t\t\t    });\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.publisher = d => {\r\n\t\t\t\t\t        let res ={}\r\n\t\t\t\t\t        $scope.field.forEach( f => {\r\n\t\t\t\t\t            res[f] = ( d[f] ) ? d[f] : null\r\n\t\t\t\t\t        })\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    }    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tget(\"data\")\r\n\t\t\t\t\tc.map({{publisher}})\r\n\r\n\r\n\t\t\t\t\texport(\"${c}.xlsx\")\r\n\r\n\t\t\t`\r\n        })\r\n        .then(res => this.$dps.getBaseURL() + res.data.url)\r\n    },\r\n\r\n    dpsLoadCollectionSample(concept) {\r\n      return this.$dps.run({\r\n          script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => {\r\n\t\t\t\t\t        let res = d.value;\r\n\t\t\t\t\t        res.id = d.id\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tdml.select(from:\"${concept}\", map:{{mapper}})\r\n\r\n\t\t\t\t\tset(\"data\")\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.attr = $scope.data.map( d => Object.keys(d));\r\n\t\t\t\t\t    $scope.field = [];\r\n\t\t\t\t\t    $scope.attr.forEach( a => {\r\n\t\t\t\t\t        $scope.field = _.union($scope.field,a)\r\n\t\t\t\t\t    });\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.publisher = d => {\r\n\t\t\t\t\t        let res ={}\r\n\t\t\t\t\t        $scope.field.forEach( f => {\r\n\t\t\t\t\t            res[f] = ( d[f] ) ? d[f] : null\r\n\t\t\t\t\t        })\r\n\t\t\t\t\t        return res\r\n\t\t\t\t\t    };    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tget(\"data\")\r\n\t\t\t\t\tc.limit()\r\n\t\t\t\t\tc.map({{publisher}})\r\n\t\t\t\t\tset(\"data\")\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.res = {\r\n\t\t\t\t\t        dataset:{\r\n\t\t\t\t\t            dimensions: Object.keys($scope.data[0]),\r\n\t\t\t\t\t            source: $scope.data\r\n\t\t\t\t\t        }\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t?>\r\n\t\t\t\t\treturn(\"res\")\r\n\t\t\t\t`\r\n        })\r\n        .then(res => res.data)\r\n    },\r\n\r\n    dpsLoadSchema() {\r\n      return new Promise((resolve, reject) => {\r\n        this.$dps.run({\r\n            script: `\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.mapper = d => d.identity\r\n\t\t\t\t\t?>\r\n\t\t\t\t\tddl.desc(\"dj-data\")\r\n\t\t\t\t\tc.map({{mapper}})\r\n\t\t\t\t`\r\n          })\r\n          .then(res => {\r\n            // console.log(res)\r\n            if (res.type == \"error\") {\r\n              reject(res.data)\r\n            } else {\r\n              resolve(res.data)\r\n            }\r\n          })\r\n      })\r\n    },\r\n\r\n    dpsUploadCollections(file) {\r\n      return this.$dps.run({\r\n        script: `\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    $scope.file = $scope.$file.name;\r\n\t\t\t\t\t?>\r\n\r\n\t\t\t\t\tfile.load({{file}})\r\n\t\t\t\t\tset(\"db\")\r\n\t\t\t\t\tddl.desc()\r\n\t\t\t\t\tset(\"collections\")\r\n\r\n\r\n\t\t\t\t\t<?javascript\r\n\t\t\t\t\t    let m = {\r\n\t\t\t\t\t        \"identity\": \"\",\r\n\t\t\t\t\t        \"schema\": \"dj-data\",\r\n\t\t\t\t\t        \"attributes\": {\r\n\t\t\t\t\t            \"value\": {\r\n\t\t\t\t\t                \"type\": \"json\"\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        },\r\n\t\t\t\t\t        \"permissions\": {\r\n\t\t\t\t\t            \"create\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"alter\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"drop\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"desc\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"select\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"any\",\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"insert\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"update\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            },\r\n\t\t\t\t\t            \"delete\": {\r\n\t\t\t\t\t                \"role\": [\r\n\t\t\t\t\t                    \"owner\",\r\n\t\t\t\t\t                    \"administrator\"\r\n\t\t\t\t\t                ]\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        },\r\n\t\t\t\t\t    };    \r\n\t\t\t\t\t    \r\n\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.sheets = Object.keys($scope.db);\r\n\t\t\t\t\t    $scope.collections = $scope.collections.map(c => c.identity)\r\n\r\n\t\t\t\t\t    $scope.toBeDrop = $scope.sheets\r\n\t\t\t\t\t                        .filter( s => _.find($scope.collections, c => c == s))\r\n\r\n\t\t\t\t\t    $scope.toBeCreate = $scope.sheets\r\n\t\t\t\t\t                .map( s => {\r\n\t\t\t\t\t\t                 let res = Object.assign({},m);\r\n\t\t\t\t\t\t                 res.identity = s\r\n\t\t\t\t\t\t                 return res\r\n\t\t\t\t\t                });\r\n\t\t\t\t\t    $scope.values = $scope.sheets.map( s => $scope.db[s].map(v=> ({id:v.id, value:v})));\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.ddlDropScript = $scope.toBeDrop\r\n\t\t\t\t\t        .map( c => \r\n\t\t\t\t\t            'ddl.drop(model:\"'+c+'\");info(\"'+c+'\")'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\")\r\n\t\t\t\t\t    $scope.ddlDropScript = ($scope.ddlDropScript) ? $scope.ddlDropScript : \"ctx('noop')\"\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.ddlCreateScript = $scope.toBeCreate\r\n\t\t\t\t\t        .map( ( c, index ) => \r\n\t\t\t\t\t            'info({{toBeCreate['+index+'].identity}});ddl.create(model:{{toBeCreate['+index+']}})'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\");\r\n\t\t\t\t\t    $scope.ddlCreateScript = ($scope.ddlCreateScript) ? $scope.ddlCreateScript : \"ctx('noop')\"\r\n\t\t\t\t\t    \r\n\t\t\t\t\t    $scope.dmlScript = $scope.sheets\r\n\t\t\t\t\t        .map( ( s, index ) => \r\n\t\t\t\t\t            'info(\"'+s+'\");dml.insertOrUpdate(into:\"'+s+'\", values:{{values['+index+']}});info()'\r\n\t\t\t\t\t        )\r\n\t\t\t\t\t        .join(\";\");\r\n\t\t\t\t\t    \r\n\t\t\t\t\t?>\r\n\t\t\t\t\tinfo(\"Drop collections\")\r\n\t\t\t\t\trun({{ddlDropScript}})\r\n\t\t\t\t\tinfo(\"Create collections\")\r\n\t\t\t\t\trun({{ddlCreateScript}})\r\n\t\t\t\t\tinfo(\"Insert or update values\")\r\n\t\t\t\t\trun({{dmlScript}})\r\n\t\t\t\t\tlog()\r\n\t\t\t\t\t`,\r\n        state: {},\r\n        file: file\r\n      }).then(res => res.data)\r\n    }\r\n  }\r\n}\r\n","<template>\r\n  <div>\r\n    <v-container v-if=\"message\">\r\n      <v-flex xs12>\r\n        <h2 class=\"warning--text font-weight-light headline\">{{message}}</h2>\r\n      </v-flex>\r\n      <v-spacer></v-spacer>\r\n      <v-btn text color=\"primary\" @click=\"uploadCollections()\">Upload collections...</v-btn>\r\n    </v-container>\r\n    <v-container v-else pa-0>\r\n      <v-row class=\"mx-0\" v-if=\"!collections\">\r\n        <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\r\n      </v-row>\r\n      <v-layout column v-if=\"collections\">\r\n        <div v-if=\"collections\">\r\n          <v-row class=\"mx-0\" align-center>\r\n            <h3 class=\"primary--text font-weight-light subheading\">\r\n              Schema: \"dj-data\" ( {{collections.length}} items )\r\n            </h3>\r\n            <v-spacer></v-spacer>\r\n            <v-btn text color=\"primary\" @click=\"uploadCollections()\">Upload collections...</v-btn>\r\n          </v-row>\r\n          <v-flex xs12 pa-2 style=\"max-height:10em; overflow:auto; border:1px solid #dedede;\">\r\n            <v-row v-for=\"(c, cIndex) in collections\" :key=\"cIndex\" class=\"pt-2 mx-0\" style=\"cursor:pointer;\" @click=\"select(c)\">\r\n              <v-icon class=\"body-1 pr-2\" :class=\"(selected && c == selected) ? 'primary--text' : 'secondary--text font-weight-light'\">\r\n                mdi-grid-large\r\n              </v-icon>\r\n              <h3 class=\"body-1\" :class=\"(selected && c == selected) ? 'primary--text' : 'secondary--text font-weight-light'\">\r\n                {{c}}\r\n              </h3>\r\n            </v-row>\r\n          </v-flex>\r\n        </div>\r\n        <div v-if=\"sampleTable\">\r\n          <v-flex xs12 pa-2>\r\n            <v-layout row align-center>\r\n              <h3 class=\"primary--text subheading font-weight-light\">\r\n                Sample from \"{{selected}}\"\r\n              </h3>\r\n              <v-spacer></v-spacer>\r\n              <v-btn text color=\"primary\" @click=\"exportCollection(selected)\">Download</v-btn>\r\n            </v-layout>\r\n            <v-data-table :headers=\"sampleTable.headers\" :items=\"sampleTable.rows\" dense calculate-widths :items-per-page=\"Number.POSITIVE_INFINITY\" hide-default-footer style=\"display: inline-grid;\" height=\"300px\" fixed-header>\r\n              <template v-slot:header=\"props\">\r\n                <td :colspan=\"sampleTable.headers.length\">\r\n                  <v-divider></v-divider>\r\n                </td>\r\n              </template>\r\n              <template v-slot:body=\"props\">\r\n                <tbody>\r\n                  <tr v-for=\"(item, rowIndex) in props.items\" :key=\"rowIndex\">\r\n                    <td v-for=\"(col, index) in sampleTable.headers\" :key=\"index\" class=\"caption\">\r\n                      {{item[col.value]}}\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </template>\r\n            </v-data-table>\r\n          </v-flex>\r\n        </div>\r\n      </v-layout>\r\n    </v-container>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { isString } from \"lodash\"\r\nlet _ = { isString }\r\nimport ioMixin from \"./ds-io.mixin.js\"\r\n\r\nexport default {\r\n\r\n  name: \"dataset-management\",\r\n\r\n  props: [\"config\"],\r\n\r\n  mixins: [ioMixin],\r\n\r\n  methods: {\r\n\r\n    exportCollection(c) {\r\n      this.dpsDownloadCollection(c)\r\n        .then(url => {\r\n          window.location.href = url\r\n        })\r\n    },\r\n\r\n    loadCollections() {\r\n      this.collections = null;\r\n      this.dpsLoadSchema()\r\n        .then(res => {\r\n          this.collections = res;\r\n          this.message = null\r\n        })\r\n        .catch(() => {\r\n          this.message = `Schema \"dj-data\" is empty.`\r\n        })\r\n    },\r\n\r\n    select(item) {\r\n      if (!this.selected) {\r\n        this.selected = item\r\n      } else {\r\n        this.selected = (this.selected == item) ? null : item\r\n      }\r\n    },\r\n\r\n\r\n    uploadCollections() {\r\n      this.selectFile()\r\n        .then(file => {\r\n          if (!file) return\r\n          this.resolveFile(file)\r\n        })\r\n    },\r\n\r\n    resolveFile(file) {\r\n      this.selectFileDialog = false;\r\n      this.sample = null;\r\n      this.collections = null;\r\n      this.message = \"Uploading...\"\r\n      this.dpsUploadCollections(file)\r\n        .then(res => {\r\n          let messages = res.data.map(m => {\r\n            let res = JSON.parse(m.message[0])\r\n            res = (_.isString(res)) ? res : JSON.stringify(res.data)\r\n            return res\r\n          }).join(\"\\n\")\r\n\r\n          this.$djvue.warning({\r\n            type: \"success\",\r\n            title: \"Upload Collections\",\r\n            text: messages\r\n          })\r\n          this.message = \"Loading...\"\r\n          this.loadCollections()\r\n        })\r\n        .catch(e => {\r\n          this.$djvue.warning({\r\n            type: \"error\",\r\n            title: \"Cannot Upload Collections\",\r\n            text: e.toString()\r\n          })\r\n        })\r\n    }\r\n\r\n  },\r\n\r\n  computed: {\r\n\r\n    sampleTable() {\r\n      if (!this.sample) return null\r\n      return {\r\n        headers: this.sample.dataset.dimensions.map(item => ({\r\n          text: item,\r\n          align: 'center',\r\n          value: item\r\n        })),\r\n        rows: this.sample.dataset.source\r\n      }\r\n    }\r\n\r\n  },\r\n\r\n  watch: {\r\n\r\n    selected(newValue) {\r\n      if (!newValue) {\r\n        this.sample = null\r\n      } else {\r\n        this.dpsLoadCollectionSample(newValue)\r\n          .then(res => {\r\n            this.sample = res\r\n          })\r\n      }\r\n    }\r\n  },\r\n\r\n  data: () => ({\r\n    collections: null,\r\n    selected: null,\r\n    sample: null,\r\n    file: null,\r\n    selectFileDialog: false,\r\n    message: \"Loading...\"\r\n  }),\r\n\r\n  created() {\r\n    this.loadCollections()\r\n  }\r\n}\r\n\r\n</script>\r\n","import mod from \"-!../../../../build/vuetify-loader/lib/loader.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../build/jace-loader/src/parser.js??ref--20-3!../../../../build/jace-loader/src/parser.js??ref--18-1!../../../../build/jace-loader/src/parser.js??ref--33-1!./dataset-management.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../build/vuetify-loader/lib/loader.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../build/jace-loader/src/parser.js??ref--20-3!../../../../build/jace-loader/src/parser.js??ref--18-1!../../../../build/jace-loader/src/parser.js??ref--33-1!./dataset-management.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./dataset-management.vue?vue&type=template&id=c4b39e76&\"\nimport script from \"./dataset-management.vue?vue&type=script&lang=js&\"\nexport * from \"./dataset-management.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../build/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VFlex } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VContainer,VDataTable,VDivider,VFlex,VIcon,VLayout,VProgressCircular,VRow,VSpacer})\n"],"sourceRoot":""}