(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1522f1a9"],{c2c6:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return t.options&&t.getPropertyValue?e("div",{staticClass:"text-annotation-container",class:t.options.decoration&&t.options.decoration.class&&t.getPropertyValue(t.options.decoration.class)||"",style:t.options.decoration&&t.options.decoration.style&&t.getPropertyValue(t.options.decoration.style)||"",on:{mouseup:t.onMouseUp}},[t._l(t.$chunks,(function(i,s){return[i&&"text"===i.type?e("span",{key:s,staticClass:"text-for-annotation",class:{"text-indent":t.isTextIndent(s)},staticStyle:{padding:"0px"},attrs:{start:i.start}},[t._v("\n            "+t._s(i.content)+"\n        ")]):t._e(),i&&"whitespaces"===i.type?e("span",[t._v(" "+t._s(i.content)+" ")]):t._e(),i&&"wrap"===i.type?e("br",{attrs:{start:i.start}}):t._e(),i&&"wrap"===i.type?e("br",{attrs:{start:i.start}}):t._e(),i&&"annotation"===i.type?e("span",{staticClass:"text-annotation mr-1",style:{border:t.border(i),cursor:"default"},attrs:{start:i.start},on:{mouseover:function(e){return t.setFocus(i.id,!0)},mouseleave:function(e){return t.setFocus(i.id,!0)},click:t.startEdit}},[t.showTooltip?e("v-tooltip",{attrs:{bottom:"",color:"#00000000","open-delay":"500"},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:n}){return[i?e("span",t._g(t._b({class:"entity-"+i.id,staticStyle:{cursor:"pointer"}},"span",n,!1),s),[t.showTag?e("span",{staticClass:"text-annotation__annotation font-weight-light px-2",class:"entity-"+i.id,style:{backgroundColor:t.tagBackground(i),color:"white",padding:"0.05em 0"}},[t._v("\n                            "+t._s(t.tagName(i))+"\n                        ")]):t._e(),e("span",{staticClass:"text-annotation__word"},[e("span",{staticClass:"px-2",class:"entity-"+i.id+" "+t.highlightClass(i),style:{backgroundColor:t.markBackground(i),padding:"0.05em 0"}},[t._v("\n                                "+t._s(i.content)+"\n                            ")])])]):t._e()]}}],null,!0)},[e("div",{staticClass:"secondary--text pa-2 ma-1",staticStyle:{background:"#ffffff",border:"1px solid #bbbbbb"}},[t.showTooltipTag?e("div",{staticClass:"title",style:{color:t.tagBackground(i)}},[t._v("\n                        "+t._s(i.tag)+"\n                    ")]):t._e(),t.showAuthor?e("div",{staticClass:"d-flex align-center"},[e("v-avatar",{attrs:{size:"36"}},[e("img",{attrs:{src:i.author.photo}})]),e("div",{staticClass:"px-3",staticStyle:{"line-height":"0.7"}},[e("div",{staticClass:"subtitle-2"},[t._v(t._s(i.author.name))]),e("div",{staticClass:"caption",staticStyle:{"margin-top":"-0.6em"}},[t._v(t._s(i.updatedAt))])])],1):t._e(),t.showComment?e("pre",{staticClass:"caption pt-2",staticStyle:{"line-height":"1"}},[t._v(t._s(t.comment(i)))]):t._e()])]):e("span",{class:"entity-"+i.id,staticStyle:{cursor:"pointer"}},[t.showTag?e("span",{staticClass:"text-annotation__annotation font-weight-bold px-2",class:"entity-"+i.id,style:{backgroundColor:t.tagBackground(i),color:"white",padding:"0.05em 0"}},[t._v("\n                    "+t._s(t.tagName(i))+"\n                ")]):t._e(),e("span",{staticClass:"text-annotation__word"},[e("span",{staticClass:"px-2",class:"entity-"+i.id+" "+t.highlightClass(i),style:{backgroundColor:t.markBackground(i),padding:"0.05em 0"}},[t._v("\n                        "+t._s(i.content)+"\n                    ")])])])],1):t._e()]})),t.edited&&!t.readonly?e("v-menu",{attrs:{"close-on-content-click":!1,"min-width":"450","max-width":"450","position-x":t.edited.position.x,"position-y":t.edited.position.y,"z-index":"5000"},on:{input:t.changeMenuModel},model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[e("div",{staticClass:"primary lighten-2 white--text pa-2 title"},[t._v("\n            Edit tag\n        ")]),e("div",{staticClass:"secondary--text px-1 pt-3",staticStyle:{background:"#ffffff"}},[t.edited?e("div",[e("div",{staticClass:"d-flex align-center mx-2 mb-4"},[e("v-avatar",[e("img",{attrs:{src:t.edited.author.photo}})]),e("div",{staticClass:"px-3",staticStyle:{"line-height":"0.7"}},[e("div",{staticClass:"subtitle-2"},[t._v(t._s(t.edited.author.name))]),e("div",{staticClass:"caption",staticStyle:{"margin-top":"-0.6em"}},[t._v(t._s(t.edited.author.role))])]),e("v-spacer"),e("div",{staticClass:"subtitle-2 text-right"},[t._v(t._s(t.edited.updatedAt))])],1),e("v-autocomplete",{staticClass:"mb-2",attrs:{"hide-details":"",outlined:"",dense:"",value:t.edited.tag,label:"Tag",items:t.options.decoration&&t.options.decoration.entities&&t.getPropertyValue(t.options.decoration.entities).map(t=>t.tag)||[]},on:{change:t.changeTag}}),t.editable?e("v-textarea",{staticClass:"mb-2",attrs:{rows:"10","hide-details":"",outlined:"",value:t.textChanges,label:"Text"},on:{input:t.changeText}}):t._e(),e("v-textarea",{staticClass:"mb-2",attrs:{"hide-details":"",outlined:"",value:t.edited.comment,label:"Comment"},on:{input:t.changeComment}})],1):t._e(),e("div",{staticClass:"d-flex"},[e("v-btn",{attrs:{text:""},on:{click:function(e){return t.removeMark()}}},[t._v("\n                    Remove\n                ")]),e("v-spacer"),e("v-btn",{attrs:{text:""},on:{click:function(e){return t.cancelMark()}}},[t._v("\n                    Cancel\n                ")]),e("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){return t.updateMark()}}},[t._v("\n                    Update\n                ")])],1)])]):t._e()],2):t._e()},n=[],o=i("c555"),a=i("4e14"),r=i("2ef0"),d=i("ec26"),h=i("c1df"),l=i.n(h);window.moment=window.moment||l.a;const c=()=>Object(r["last"])(Object(d["a"])().split("-"));var u={props:["options","getPropertyValue"],mixins:[o["a"],a["a"]],data:()=>({focused:null,menu:null,edited:null,menu:!1,textChanges:"",originalText:""}),computed:{showTooltip(){let t=this.decoration.tooltip||{},e=!!Object(r["isUndefined"])(t.show)||t.show;return e},showTag(){let t=this.decoration.tag||{},e=!!Object(r["isUndefined"])(t.show)||t.show;return e},showTooltipTag(){let t=this.decoration.tooltip||{},e=!!Object(r["isUndefined"])(t.tag)||t.tag;return e},showDate(){let t=this.decoration.tooltip||{},e=!!Object(r["isUndefined"])(t.updatedAt)||t.updatedAt;return e},showAuthor(){let t=this.decoration.tooltip||{},e=!!Object(r["isUndefined"])(t.author)||t.author;return e},showComment(){let t=this.decoration.tooltip||{},e=!!Object(r["isUndefined"])(t.comment)||t.comment;return e}},created(){this.options&&(this.text=this.options&&this.options.data&&this.getPropertyValue(this.options.data.text)||"",this.text=this.text.replace(/[ ]{2,}/g," "),this.entities=this.options&&this.options.data&&this.getPropertyValue(this.options.data.value)||[],this.readonly=this.options&&this.options.data&&this.getPropertyValue(this.options.data.readonly)||!1,this.editable=this.options&&this.options.data&&this.getPropertyValue(this.options.data.editable)||!1,this.decoration={entities:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.entities)||[],tag:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.tag)||{show:!0,tagname:!0},tooltip:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.tooltip)||{show:!0,tag:!0,author:!0,updatedAt:!0,note:!0},highlight:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.highlight)||{show:!0,class:"font-weight-bold"},class:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.class)||"",style:this.options&&this.options.decoration&&this.getPropertyValue(this.options.decoration.style)||""},this.chunks&&this.chunks())},methods:{chunks(){if(!this.options)return[];let t=this.text||"";return this.entities.forEach(t=>{t.id=t.id||c()}),this.entities=Object(r["sortBy"])(this.entities,t=>t.start),this.$chunks=this.generateChunks({text:t,entities:this.entities}),this.$chunks},generateTextChunks(t,e){let i=[];const s=t.split("\n");return s.forEach((t,n)=>{i.push({type:"text",content:t,start:e}),e+=t.length,n<s.length-1&&(i.push({type:"wrap",content:"\n",start:e}),e++)}),i.map(t=>("text"!=t.type||t.content.trim()||(t.type="whitespaces"),t))},generateChunks({text:t,entities:e}){let i=[],s=0,n=e.filter(t=>!t.disabled);n.forEach(e=>{let n=t.substring(s,e.start);i=i.concat(this.generateTextChunks(n,s)),s+=e.start+1,n=t.substring(e.start,e.end),s=e.end;let o={id:e.id,type:"annotation",author:e.author,tag:e.tag,comment:e.comment,content:n,start:e.start,end:e.end,disabled:e.disabled||!1,updatedAt:l()(new Date(e.updatedAt)).format("DD MMM., YYYY HH:mm"),newItem:e.newItem};i.push(o)});let o=t.substring(s);return i=i.concat(this.generateTextChunks(o,s)),i},isTextIndent(t){return 0===t},tagBackground(t){let e=Object(r["find"])(this.decoration.entities,e=>e.tag==t.tag);return e&&e.color||"#777777"},tagName(t){let e=this.decoration.tag||{},i=!!Object(r["isUndefined"])(e.tagname)||e.tagname;return 1==i?t.tag:i||t.tag},markBackground(t){let e=Object(r["find"])(this.decoration.entities,e=>e.tag==t.tag);return e?e.color+"40"||!1:"#77777740"},comment(t){return t.comment?t.comment:""},setFocus(t,e){this.focused=t&&!0===e?t:null},isEdited(t){return!!this.edited&&Object(r["findIndex"])(this.entities,e=>e.id==t.id)>=0},border(t){let e=this.decoration.highlight||{},i=!!Object(r["isUndefined"])(e.show)||e.show;return t.id==this.focused&&i?"2px solid "+this.tagBackground(t):"2px solid #ffffff"},highlightClass(t){let e=this.decoration.highlight||{},i=this.getPropertyValue(e.class)||"",s=!!Object(r["isUndefined"])(e.show)||e.show;return t.id==this.focused&&s?i:""},changeMenuModel(t){this.needEdit?this.$nextTick(()=>{this.edited=JSON.parse(JSON.stringify(this.needEdit)),this.needEdit=null,this.menu=!0}):this.edited=null},getTextFromTags(){return this.$chunks.map(t=>t.content).join("")},updateMark(){let t=Object(r["findIndex"])(this.entities,t=>t.id==this.edited.id),e=Object(r["find"])(this.$chunks,t=>t.id==this.edited.id);e&&(e.content=this.textChanges.split("\n").join(" ")),this.text=this.getTextFromTags(),this.edited.updatedAt=this.edited.$date,delete this.edited.newItem,delete this.edited.$date,this.entities.splice(t,1,Object(r["extend"])({},this.edited));let i=0;this.$chunks.forEach(t=>{if("annotation"==t.type){let e=Object(r["find"])(this.entities,e=>e.id==t.id);e&&(e.start=i,e.end=i+t.content.length,e.text=this.text.substring(e.start,e.end),e.content=t.content)}i+=t.content.length}),this.textChanges.length>0?this.setFocus(this.edited.id,!0):this.setFocus(null,!0),this.edited=null,this.menu=!1,this.$emit("change",this,{text:this.text,entities:this.entities}),this.chunks()},cancelMark(){let t=Object(r["findIndex"])(this.entities,t=>t.id==this.edited.id);this.entities[t].menu=!1,this.entities.splice(t,1,Object(r["extend"])({},this.entities[t])),this.edited=null,this.menu=!1},removeMark(){let t=Object(r["findIndex"])(this.entities,t=>t.id==this.edited.id);this.entities.splice(t,1),this.edited=null,this.menu=!1,this.entities.length>0?this.setFocus(Object(r["last"])(this.entities).id,!0):this.setFocus(null,!0),this.$emit("change",this,{text:this.text,entities:this.entities}),this.chunks()},startEdit(t){let e=t.target.classList.value.split(" ").filter(t=>t.startsWith("entity-"))[0];if(e=e?e.split("-")[1]:null,!e)return;let i=t.target.getClientRects(),s=1/0,n=-1/0;for(const a of i)s=Math.min(s,a.left),n=Math.max(n,a.bottom);n+=8;let o=Object(r["find"])(this.entities,t=>t.id==e);o&&(this.setFocus(o.id,!0),this.edited=Object(r["extend"])({},o),this.edited.position={x:s,y:n},this.edited.author={name:window.user.name,role:window.user.role,photo:window.user.photo},this.textChanges=this.edited.text,this.originalText=this.edited.text,this.edited.$date=new Date,this.edited.updatedAt=l()(new Date(this.edited.$date)).format("DD MMM., YYYY HH:mm"),this.needEdit=JSON.parse(JSON.stringify(this.edited)),this.menu=!0)},changeTag(t){this.edited.tag=t},changeComment(t){this.edited.comment=t},changeText(t){this.textChanges=t},containsMarks(t,e){return e.filter(e=>e.start>t.start&&e.start<t.end||e.end>t.start&&e.end<t.end).length>0},selectWords({start:t,end:e}){const i=t=>t.split("").reverse().join("");let s=this.text.substring(t,e),n=s.indexOf(s.trim()),o=i(s).indexOf(i(s).trim());t+=n,e-=o+1;const a=/[ \n\t]/;while(t>=0&&!a.test(this.text[t]))t--;t++;while(e<this.text.length&&!a.test(this.text[e]))e++;return{start:t,end:e}},getNodeStart(t){return t.getAttribute?Number.parseInt(t.getAttribute("start")):null},getOffset(t){let e=0,i=t.innerHTML,s=t.innerText[0];while(i[e]!=s&&e<i.length)e++;return e},onMouseUp(t){if(this.readonly)return;const e=t.target;if(e.classList.contains("text-for-annotation")||e.classList.contains("text-annotation-container")){const t=window.getSelection();if(null!==t&&t.toString().length){t.focusNode,t.anchorNode;let e=t.getRangeAt(0),i=e.commonAncestorContainer,s=0==i.childNodes.length?[i.parentNode]:Array.from(i.children).filter(t=>t.classList.contains("text-for-annotation")),n=Object(r["findIndex"])(s,t=>t==e.startContainer.parentNode),o=Object(r["findIndex"])(s,t=>t==e.endContainer.parentNode);s=s.slice(n,o+1);let a=[];if(1==s.length){let t=this.getOffset(s[0]);a.push({start:e.startOffset-t+this.getNodeStart(s[0]),end:e.endOffset-t+this.getNodeStart(s[0]),text:this.text.substring(e.startOffset-t+this.getNodeStart(s[0]),e.endOffset-t+this.getNodeStart(s[0]))})}s.length>1&&s.forEach((t,i)=>{if(0==i){let i=this.getOffset(s[0]),n=t.innerText.substring(e.startOffset-i).length;a.push({start:e.startOffset-i+this.getNodeStart(t),end:e.startOffset-i+this.getNodeStart(t)+n,text:this.text.substring(e.startOffset-i+this.getNodeStart(t),e.startOffset-i+this.getNodeStart(t)+n)})}if(i==s.length-1){let i=this.getOffset(s[0]);t.innerText.substring(0,e.endOffset-i).length;a.push({start:this.getNodeStart(t),end:e.endOffset-i+this.getNodeStart(t),text:this.text.substring(this.getNodeStart(t),e.endOffset-i+this.getNodeStart(t))})}if(i<s.length-1&&i>0){let e=t.innerText.length;a.push({start:this.getNodeStart(t),end:this.getNodeStart(t)+e,text:this.text.substring(this.getNodeStart(t),this.getNodeStart(t)+e)})}});let d=[];a.forEach(t=>{let e=t.start,i=t.end,s=this.selectWords({start:e,end:i}),n=Object(r["find"])(this.decoration.entities,t=>t.default);n=n?n.tag:"comment";const o={id:c(),tag:n,author:{name:window.user.name,role:window.user.role,photo:window.user.photo},updatedAt:new Date,start:s.start,end:s.end,text:this.text.substring(s.start,s.end).trim(),newItem:!0};d.push(o)}),this.entities=this.entities.concat(d),this.$emit("change",this,{text:this.text,entities:this.entities}),t.removeAllRanges(),this.chunks(),setTimeout(()=>{this.setFocus(Object(r["last"])(this.entities).id,!0),setTimeout(()=>{this.$forceUpdate()},20)},20)}}}}},p=u,g=i("2877"),f=i("fef8"),m=i.n(f),x=i("c6a6"),b=i("8212"),y=i("8336"),w=i("e449"),v=i("2fa4"),C=i("a844"),_=i("3a2f"),k=Object(g["a"])(p,s,n,!1,null,null,null);e["default"]=k.exports;m()(k,{VAutocomplete:x["a"],VAvatar:b["a"],VBtn:y["a"],VMenu:w["a"],VSpacer:v["a"],VTextarea:C["a"],VTooltip:_["a"]})},ec26:function(t,e,i){"use strict";var s,n=new Uint8Array(16);function o(){if(!s&&(s="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(n)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function r(t){return"string"===typeof t&&a.test(t)}for(var d=r,h=[],l=0;l<256;++l)h.push((l+256).toString(16).substr(1));function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!d(i))throw TypeError("Stringified UUID is invalid");return i}var u=c;function p(t,e,i){t=t||{};var s=t.random||(t.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var n=0;n<16;++n)e[i+n]=s[n];return e}return u(s)}e["a"]=p}}]);
//# sourceMappingURL=chunk-1522f1a9.2b7219be.js.map